---
title             : "The dark (and light) side of social media"
shorttitle        : "The dark (and light) side of social media"

author: 
  - name          : "Cameron S. Kay"
    affiliation   : ""
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Psychology, 1227 University of Oregon, Eugene, OR 97403"
    email         : "ckay@uoregon.edu"
  - name          : "Ashley L. Miller"
    affiliation   : ""

affiliation:
  - id            : ""
    institution   : "University of Oregon"

authornote: |
  Cameron Stuart Kay, Department of Psychology, University of Oregon; Ashley L. Miller, Department of Psychology, University of Oregon.

abstract: | 
  The current study examines potential sources of variation in frequency visiting social media sites and overall time spent on social media each day. In particular, the relations between the Dark Triad traits (i.e., Machiavellianism, psychopathy, and narcissism) and social media use are discussed. Furthermore, interactions between the Dark Triad and gender are explored, suggesting that these two factors interact in predicting social media use, depending on the social media site in question.  Overall, there are robust and important personality-related individual differences in social media use, and it is suggested that future research is needed to better clarify why certian social media platforms attract those with "darker" personalities.
  
keywords          : "social media use, Dark Triad, gender"

wordcount         : 107

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
figsintext        : no #Plots will be referenced at end
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

header-includes:
  - \raggedbottom
  - \setlength{\parskip}{0pt} #Equations are now left-aligned

documentclass     : "apa6"
classoption       : "man, fleqn, noextraspace" #Odd spacing around paragraphs and headers is removed
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}

# set knitr options
knitr::opts_chunk$set(echo       = FALSE,
                      message    = FALSE,
                      warning    = FALSE,
                      fig.width  = 7.5,
                      fig.height = 4.5)

# install packages if you do not have them installed already
# devtools::install_github("datalorax/sundry")
# devtools::install_github("crsh/papaja")
# install.packages("tidyverse")
# install.packages("rio")
# install.packages("here")
# install.packages("magrittr")
# install.packages("lme4")
# install.packages("lmerTest")
# install.packages("psych")
# install.packages("glue")
# install.packages("sjstats")

# load packages
library(sundry) # for calculating standard errors
library(papaja) # for creating the apa journal article
# I had to find this package on GitHub and install it. I also had to remove the quotes
# from the package name in the library() call.

library(tidyverse) # for purrr, dplyr, and ggplot2 functions
library(rio) # for easy imporrting of data
library(here) # for reproducible paths
library(magrittr) # for the compound assigiment pipe-operator
library(lme4) # for conducting linear mixed-effects models
library(lmerTest) # for calculating t-tests for linear mixed-effects models
library(psych) # for caculating cronbach's alpha
library(glue) # for gluing together strings during parallel iteration
library(sjstats) # for caalculating betas

######################################
### Below are 12 custom functions ####
########### only 2 required ########## 
######################################

# source custom functions (the rmarkdown document is unwieldy otherwise);
# we also considered adding them to a package, but we didn't want it to be too 
# hard for reviewers to find the functions
source(here("functions", "str_cols_find.R")) # CUSTOM FUNCTION 1: for extracting
                                             # columns from a dataframe using a 
                                             # string
source(here("functions", "name_creator.R"))  # CUSTOM FUNCTION 2: for creating
                                             # variable names given strings
source(here("functions", "range_mean.R"))    # CUSTOM FUNCTION 3: create a 
                                             # function for calculating the mean 
                                             # of a time response given as a 
                                             # character range. Example: "like 
                                             # 3-5 hours a day" would become "4"
source(here("functions", "str_alpha.R"))     # CUSTOM FUNCTION 4: for 
                                             # calculating cronbach's alpha for
                                             # columns that match a string
source(here("functions", "str_composite.R")) # CUSTOM FUNCTION 5: for 
                                             # calculating rowmeans for
                                             # columns that match a string
source(here("functions", "spround.R"))       # CUSTOM FUNCTION 6: for rounding 
                                             # and formatting for printing in 
                                             # one step
source(here("functions", "perble.R"))        # CUSTOM FUNCTION 7: for creating a
                                             # a table with the percentages
source(here("functions", "lenique.R"))       # CUSTOM FUNCTION 8: calculates the
                                             # length of unique values
source(here("functions", "con_to_cat.R"))    # CUSTOM FUNCTION 9: quantile 
                                             # splits a numeric column
source(here("functions", "paste_msd.R"))     # CUSTOM FUNCTION 10: for combining
                                             # a mean and sd for a table; wraps
                                             # sd in parantheses
source(here("functions", "p_to_ast.R"))      # CUSTOM FUNCTION 11: for creating
                                             # a vector of asterisks from a 
                                             # vector of p-values
source(here("functions", "tdp_from_pars.R")) # CUSTOM FUNCTION 12: for 
                                             # calculating t, d, and p from
                                             # the calculated mean, sd, and n


# create a vector of the custom functions
custom_functions <- objects()

# import data as tibble and clean column names
data1 <- rio::import(here::here("data", "data_1.xlsx"), setclass = "tibble") %>%
  janitor::clean_names()

# turn off scientific notation
options(scipen = 999)

# set a table incrementer (the papaja table referencer is not working for me)
table_count <- 0
```

```{r data1_rename, include = FALSE}
# drop the display order columns and the custom demographic columns
data1 %<>%
  select(-contains("do"),
         -contains("text"))

# manualy rename the demographic columns
data1 %<>%
  rename(age    = q1_1,
         gender = q1_2,
         race   = q1_4)


# create vectors of subscale names
dd_subs  <- c("mach", "narc", "psyc") # subscales for the dirty dozen scale

sns_subs <- c("facebook", # subscales for the frequency and length of sns use 
              "pinterest", 
              "instagram", 
              "linkedin", 
              "twitter", 
              "snapchat", 
              "youtube", 
              "whatsapp", 
              "reddit", 
              "4chan", 
              "tumblr")

con_subs <- c("society", # subscales for questions assessing benefit of sns
              "self")
 
mot_subs <- c("inform", # subscales for the motivations to use the internet 
              "interp", # scale
              "entert")
 
add_subs <- c("salience", # susbscales for the internet addiction scale
              "tolerance",
              "mood",
              "relapse",
              "withdraw",
              "conflict")

# create a tibble containing all the necessary information for renaming the 
# columns
data_rename <- tibble(
                      # the scale names
                      scale_names = c("dd", 
                                      "freq",
                                      "len",
                                      "sns_perc",
                                      "int_mot",
                                      "int_addict"),
                      # the scale subscales created above
                      sub_names   = list(dd_subs,
                                         sns_subs,
                                         sns_subs,
                                         con_subs,
                                         mot_subs,
                                         add_subs),
                      # the total length of the scales
                      scale_lens  = c(12, 11, 11, 2, 20, 18),
                      # the length of the subscales (only one value if all are 
                      # the same length)
                      sub_lens    = list(4, 1, 1, 1, c(8, 7, 5), 3))


########################################################
### instance of parallel iteration # 1 (1 required) ####
########################################################

# iterate through the data_rename tibble and create a list of column names
col_names <- pmap(list(data_rename$scale_names,
                       data_rename$sub_names,
                       data_rename$scale_lens,
                       data_rename$sub_lens),
                  ~name_creator(..1, ..2, ..3, ..4)
)

# assign created column names to data1
names(data1)[str_cols_find("q7", data1)] <- unlist(col_names)

# remove uneeded variables
rm(list = setdiff(ls(), c("data1", "col_names", "custom_functions", "table_count", custom_functions)))
```

```{r data1_convert_to_long, include = FALSE}
# add an id column to the data
data1 %<>%
  mutate(id = 1:n()) %>%
  select(id, everything())

# transform the data to long format with respect the the frequency of sns use 
# and the length of sns use
data1 %<>%
  # over gather all frequency and length columns
  gather("key", "value", freq_facebook:len_tumblr) %>%
  # separate the key columns into a column specifying freq/length and a column
  # specifying the social media site
  separate(key, into = c("variable", "sns"), sep = "_") %>%
  # spread the frequency and length column into two separate columns
  spread(variable, value)

# transform the data to long format with respect to perception of sns
data1 %<>%
  # gather the two columns (i.e., benefit of sns to the self and benefit of sns
  # to society)
  gather("sns_perc_context", "sns_perc_rating", starts_with("sns_perc")) %>%
  # drop all text before "self" or "society
  mutate(sns_perc_context = gsub(".*_", "", sns_perc_context))

```

```{r data1_parse_length, include = FALSE}
# identify the units responses were given in (even though I specifically 
# requested that the responses be provided in  minutes)
data1 %<>%
  mutate(len_unit  = case_when(grepl("(hour|hr)", len) ~ 60,
                               TRUE                    ~ 1))

#######################################################
#### Variant of purr::map #1 (at least 2 required) ####
#######################################################

# replace all range responses with the means of those ranges
data1$len <- map_chr(data1$len, range_mean)

# parse the numbers
data1 %<>%
  mutate(# replace written numbers with arabic numerals
         len = case_when(len == "ten"                  ~ "10",
                         len == "3o"                   ~ "30",
                         len == "sixty"                ~ "60",
                         len == "eighty"               ~ "80",
                         grepl("(zero|no|never)", len) ~ "0",
                         TRUE                          ~ len),
         # parse the numbers
         len = parse_number(len),
         # calculate the length in minutes by multipling the unit by the length
         len = len * len_unit) %>%
         # drop the unit column
         select(-len_unit)
```

```{r data1_format, include = FALSE}
# factorize and label factors
data1 %<>%
  mutate(# factorize gender and apply labels
        gender           = factor(gender, labels = c("Male",
                                                     "Female",
                                                     "Non-binary",
                                                     "Prefer not to say",
                                                     "Other")),
        # factorize race and apply labels
        race             = factor(race, labels   = c("American Indian or Alaska Native",
                                                     "Asian",
                                                     "Black or African American",
                                                     "Native Hawaiian or Other Pacific Islander",
                                                     "Caucasian",
                                                     "Hispanic, Latinx, or Spanish Origin",
                                                     "Middle Eastern or North African",
                                                     "I prefer not to answer",
                                                     "Some other ethnicity or origin")),
        # factorize social media site
        sns              = factor(sns),
        # factorize context
        sns_perc_context = factor(sns_perc_context),
        # numerize frequency
        freq             = as.numeric(freq))

```

```{r data1_composites, include = FALSE}
# drop column names not to be made into composites
comp_names <- col_names[-2:-4]

#######################################################
#### Variant of purr::map #2 (at least 2 required) ####
#######################################################

# drop item identifiers (e.g.,  the "_7" in "dd_7") to create the composite 
# names; retain only unique names (e.g., "dd")
comp_names %<>%
  map(str_replace, "_\\d", "") %>%
  map(unique)


#######################################################
#### Variant of purr::map #3 (at least 2 required) ####
#######################################################

# calculate alphas for the composites 
alphas <- comp_names %>%
  map(map_dbl, str_alpha, data = data1, full = FALSE) %>%
  flatten_dbl() 

# name the alpha composites
names(alphas) <- flatten_chr(comp_names)

#######################################################
#### Variant of purr::map #4 (at least 2 required) ####
#######################################################

# create composites
data_comp <- comp_names %>%
  map(map, str_composite, data1) %>%
  flatten_dfc()

# assign names to the created composites
names(data_comp) <- paste0(flatten_chr(comp_names), "_comp")

# combine the composites with the existing dataframe
data1 <- data1 %>%
  cbind(data_comp)

# clean up the environment
rm(list = setdiff(ls(), c("data1", "alphas", "custom_functions", "table_count", custom_functions)))
```

# Intro

In 2005—one year before Facebook went public—only 5% of American adults had reported using even one social media site [@Smith2018a]. Thirteen-years later, in 2018, that number had risen to include 69% of American adults. It would be hard to argue there hasn’t been a profound increase in the number of Americans using social media, but this 69% figure does vary depending on age bracket. Over twice as many 18-to-29 year-olds reported using social media when compared to those older than 65 (88% and 37%, respectively). This population variation was not restricted to age, however: Eight percent more women used social media than men, and 16% more people from urban communities used social media than their non-urban counterparts. Recently, psychologists have turned to personality traits to explain some of the remaining variation in social media use. 

With some notable exceptions, the research conducted in the overlapping region between personality and communications has focused primarily on ostensibly-positive personality traits. Negative personality traits have been left largely unexplored. The present study aims to fill this void. To that end, we administered a survey assessing an individual’s levels of the Dark Triad personality traits (i.e., Machiavellianism, narcissism, and psychopathy), the amount of time they actively spend on social media sites, and the frequency with which they visit social media sites.

A common definition for a social media site is that it is an internet-based service allowing for the creation and broadcast of user-generated information [@Boyd2008; @Kaplan2010; @Obar2015]. @Obar2015 emphasize the user-generated aspect of this definition, arguing that this content is the lifeblood of social media. Although a substantial claim, it logically follows that if a site is created with the express purpose of providing user-generated content, the site must have user-generated content to function as intended. By way of illustration, without videos created by users, YouTube, a social media site that allows its users to upload and share videos, would fail to serve its primary purpose. Netflix, a site that allows users to only stream videos, does not require user-generated content, as it does not serve user-generated content, and, by extension is not a social media site. Beyond the teleological aspects of social media sites, the user-generated focus also highlights the importance of individual differences in the user-service relationship, as users invariably have personalities that affect how they consume and generate content. One popular method for assessing personality in terms of social media use has been the Big Five [@John1999].

The Big Five is an overarching personality construct that distinguishes between five generally positive personality sub-constructs: openness to experience, conscientiousness, extraversion, agreeableness, and emotional stability (i.e., neuroticism). Extroversion is typified by sociability and gregariousness--characteristics that seem intuitively linked with the performative and social aspects of social media. Perhaps unsurprisingly, extraversion has been the focus of the majority of research on whether an individual will use social media and how an individual will use social media. 

With respect to whether an individual will use social media, prior work demonstrates that extraversion is positively correlated with both general social media use [@Correa2010], and Facebook use in particular [@Harbaugh2010; @Jenkins-Guarnieri2012]. Regarding how individuals use social media, individuals high in extraversion are more likely to use Facebook and the internet to communicate with others than those low in extraversion [@Seidman2013; @Wolfradt2001]. Moreover, @Moore2012 found that extraversion is positively correlated with the number of friends a person has on Facebook. Those with the lowest levels of extraversion had, on average, 484 fewer friends than those scoring in the top 10%. Similar to extraversion, those high in emotional stability tend to use more social media [@Correa2010]. Even prior to the introduction of most, if not all, social media sites, emotional stability was found to be positively correlated with using the internet for communication and entertainment [@Wolfradt2001]. Despite the apparent value in studying these personality traits, research thus far has largely ignored the distinctly darker aspects of personality. 

The Dark Triad is a construct comprising the following inter-correlated, yet distinct traits: Machiavellianism, sub-clinical narcissism, and sub-clinical psychopathy. The Dark Triad has garnered substantial interest since its introduction by @Paulhus2002. Machiavellianism originated with Niccolò Machiavelli’s essay, Il Principe [@NiccoloMachiavelli2006], which provided advice on how to properly rule one’s subjects. The advice is most succinctly summarized within the sub-scales of its most popular measure (i.e., the MACH-IV) [@Christie1970]: be tactical, distrust others, and use pragmatic morality. Narcissism, on the other hand, originated with the Greek myth of Narcissus, who died after becoming fixated on his own reflection in a pool of water. Its present sub-clinical incarnation emerged with the creation of the 80-item Narcissistic Personality Inventory (NPI) [@Raskin1979] and has been further adapted into the widely-used NPI-40 [@Raskin1988] and the brief NPI-16 [@Ames2006]. A distillation of these inventories suggests that the current conceptualization of narcissism includes a combination of grandiosity, arrogance, entitlement, and vanity. 

Finally, the etymologically ambiguous psychopathy (i.e., “mind” + “illness”) was historically used to refer to a constellation of deficiencies including emotional instability, criminal tendencies, inadequate personality, and pathological lying (United States, 1921, in Huddleson, 1926). Despite nearly 100 years of refinement, psychopathy includes many of the same elements as its original conceptualization. As captured within the fourth edition of the self-report psychopathy scale (SRP-IV) [@Paulhusa], psychopathy is currently operationalized as a combination of four separate facets: (1) interpersonal (e.g., use of manipulation in one’s relationships), (2) affective (e.g., little remorse or guilt), (3) lifestyle (e.g., impulsivity), and (4) antisocial (e.g., breaking laws).

Previous research on the relationship between negative personality traits and social media has primarily focused on narcissism, seemingly because, as with extraversion, narcissism seems to be intuitively linked to performative behaviours. In fact, narcissistic individuals likely exhibit a fair amount of extraversion, as evidenced by the consistent positive correlations found between the two traits [@Muris2017]. Narcissism has been found to be related to posting selfies on social networking sites [@Fox2015; @McCain2016; @Moon2016; @Sorokowski2015; @Weiser2015], with a feedback loop appearing to exist between narcissism and the posting of selfies. That is, a narcissistic disposition seems to cause an individual to post more selfies, and posting selfies seems to cause a more narcissistic disposition [@Halpern2016]. Narcissism has also been found to be positively correlated with viewing and commenting on photos on Facebook [@Alloway2014], as well as posting on both Facebook and Twitter [@Panek2013].

The other two Dark Triad traits (i.e., Machiavellianism and psychopathy) have been largely ignored when it comes to investigating their potential influence on social media. Presumably this is due to the absence of a strong theoretical link between the traits and social media use. Nevertheless, Machiavellianism has been found to be negatively correlated with the amount of time spent on Facebook [@Garcia2014] and is positively correlated with trolling on the internet [@Buckels2014]. Psychopathy, on the other hand, has been found to be associated with using Instagram to post selfies [@McCain2016]. Though, the potential, and likely, interrelation between psychopathy and narcissism was not controlled for. It is plausible that the more impulsive aspects of the psychopathic character may cause an individual to be less restrained when posting to social media, but it is equally plausible that psychopathic individuals tend to be higher in narcissism and, consequently, post more selfies. 

The present study aims to further explore the relationship between a person’s levels of the Dark Triad traits and their use of social media. Instead of focusing on specific aspects of posting and commenting, we hope to address how the overall use of social media sites is related to personality. Additionally, we wish to explore whether certain sites are frequented by those high on the Dark Triad more than others. The sites investigated are the eight most popular social media sites in the United States as of 2018: Facebook, Pinterest, Instagram, LinkedIn, Twitter, Snapchat, YouTube, and WhatsApp [@Smith2018a], as well as Reddit, 4chan, and Tumblr.

With respect to concrete hypotheses, we expected that (1) narcissism would positively correlate with both the frequency of visiting social media and the amount of time spent on social media, independent of the other Dark Triad traits and irrespective of the exact social media site in question. We also expected (2) psychopathy would positively correlate with the frequency of general social media use and time spent on social media sites, even when controlling for the effect of narcissism and Machiavellianism and irrespective of the exact social media site in question. Finally, we expected (3) Machiavellianism would be independent of the other Dark Triad traits—negatively correlated with both frequency of visiting social media and time spent on social media sites, once again irrespective of the exact social media site in question. Differences in whether dark personalities use certain sites more than other sites and interactions with gender will be investigated in a purely exploratory fashion. 

# Method

## Participants

```{r data1_participants, include = FALSE}
# calculate sample size at the start
sample_start <- lenique(data1$id)

# remove participants with low response durations
data1 %<>%
  filter(duration_in_seconds > 90)

# calculate number of participants dropped for low response durations
exclusions_duration <- sample_start - lenique(data1$id)

# calculate the standard deviations of responses for every participant
data1_sd <- data1 %>%
  # select only the item columns
  select(id, matches("\\d")) %>%
  # retain only rows that have a distinct id row
  distinct(id, .keep_all = TRUE) %>%
  # create groups by id
  nest(-id)

#######################################################
#### Variant of purr::map #5 (at least 2 required) ####
#######################################################

  # calculate a separate sd for each group (subject)
data1_sd$resp_sd <- map_dbl(data1_sd$data, ~sd(unlist(.x), na.rm = TRUE))

  # add the sds back to data1
data1 <- data1_sd %>%
  # drop the data column
  select(-data) %>%
  # join the two data frames by id
  right_join(data1, by = "id") %>%
  # filter out response sds that are equal to 0
  filter(resp_sd != 0)

  # drop unneeded dataframe 
rm(data1_sd)

# calculate number of participants dropped for low standard deviations
exclusions_sd <- sample_start - exclusions_duration - lenique(data1$id)

# since we are interested in gender as a predictor, drop non-conventional genders
data1 %<>%
  filter(gender == "Female" | gender == "Male")

# calculate number of participants dropped for not being female/male
exclusions_gender <- sample_start - exclusions_duration - exclusions_sd - lenique(data1$id)

# get a dataframe of only unique ids for calculating demographic information
data1_distinct <- data1 %>%
  distinct(id, .keep_all = TRUE)

# calculate demographic information for gender
demo_gender <- data1_distinct %>%
  select(gender) %>%
  perble()

# calculate demographic information for culture
demo_culture <- data1_distinct %>%
  select(race) %>%
  perble()

# calculate descriptives for age
demo_age <- data1_distinct$age %>%
  as.numeric() %>%
  describe() %>%
  unlist()
```

A total of `r sample_start` participants were recruited from the human subject pool at the University of Oregon. Data was collected over one academic quarter, and all participants were compensated with course credit necessary for meeting a course research requirement. The length of the survey was 10 minutes.  Participants completing the survey in under 90 seconds would have been excluded from analysis, but no participants met this threshold. We did, however, exclude a single participant for having a response standard deviation of zero across all surveys, an indicator of straightlining. Since we were interested in the effects of gender on social media use and considering that the sub-samples for the non-conventional genders were too small to be properly analyzed, we also excluded participants who reported being neither female nor male (*n* = `r exclusions_gender`). Our resulting sample comprised `r lenique(data1$id)` participants (`r spround(demo_gender["Percent", "Female"], 2)`% female; age range: `r demo_age["min"]` to `r demo_age["max"]` years; *M* age = `r demo_age["mean"]`, *SD* age = `r demo_age["sd"]`). With respect to cultural identity, `r spround(demo_culture["Percent", "Caucasian"], 2)`% reported being Caucasian, `r spround(demo_culture["Percent", "Asian"], 2)`% reported being Asian, `r spround(demo_culture["Percent", "Hispanic, Latinx, or Spanish Origin"], 2)`% reported being Hispanic, Latinx, or Spanish, `r spround(demo_culture["Percent", "Black or African American"], 2)`% reported being black or African American, and `r spround(100 - sum(sort(demo_culture["Percent", ], TRUE)[1:4]), 2)`% identified as being from some other culture, from multiple cultures, or preferred not to answer the question. 

## Procedures and Materials
```{r data1_measures_comps}
# drop unneeded variables from previous section
rm(list = setdiff(ls(), c("data1", "alphas", "data1_distinct", "table_count", "custom_functions", custom_functions)))

# drop individual item columns
data1 %<>%
  select(-matches("\\d"))

# calculate descriptives for the overall, female, and male composite columns
descript_comps <- data1_distinct %>%
  select(ends_with("_comp")) %>%
  describe() %>%
  select(vars, n, mean, sd)

descript_comps <- data1_distinct %>%
  filter(gender == "Female") %>%
  select(ends_with("_comp")) %>%
  describe() %>%
  select(vars, n_fem = n, mean_fem = mean, sd_fem = sd) %>%
  right_join(descript_comps, by = "vars")

descript_comps <- data1_distinct %>%
  filter(gender == "Male") %>%
  select(ends_with("_comp")) %>%
  describe() %>%
  select(vars, n_mal = n, mean_mal = mean, sd_mal = sd) %>%
  right_join(descript_comps, by = "vars")

# create a column with the composite names
descript_comps$vars <- str_cols_find("_comp", data1, return = "names")

########################################################
### instance of parallel iteration # 2 (1 required) ####
########################################################

# calculate t, p, and d for the gender comparisons
descript_comps <- cbind(descript_comps,
                        pmap_df(list(m1  = descript_comps$mean_fem,
                                     m2  = descript_comps$mean_mal,
                                     sd1 = descript_comps$sd_fem,
                                     sd2 = descript_comps$sd_mal,
                                     n1  = descript_comps$n_fem,
                                     n2  = descript_comps$n_mal),
                                tdp_from_pars))

# round valuess and include asterisks
descript_comps %<>%
  mutate(d   = spround(d),
         ast = p_to_ast(p),
         t   = spround(t))
  
# format composite descriptives for output
descript_comps %<>%
  mutate(Overall = paste_msd(spround(mean), spround(sd)),
         Female  = paste_msd(spround(mean_fem), spround(sd_fem)),
         Male    = paste_msd(spround(mean_mal), spround(sd_mal))) %>%
  select(Trait = vars, 
         Overall, 
         Female, 
         Male,
         `$t$` = t, 
         ` `   = ast,
         `$d$` = d)

# create meaningful trait names
descript_comps$Trait <- c("Machiavellianism",
                          "Narcissism",
                          "Psychopathy",
                          "Information",
                          "Interpersonal",
                          "Entertaining",
                          "Salience",
                          "Tolerance",
                          "Mood",
                          "Relapse",
                          "Withdrawal",
                          "Conflict")

# insert stub headers
descript_comps <- rbind(c("\\textit{Dark Triad}", rep("", ncol(descript_comps) - 1)),
                        descript_comps[1:3, ],
                        c("\\textit{Motivation}", rep("", ncol(descript_comps) - 1)),
                        descript_comps[4:6, ],
                        c("\\textit{Addiction}",  rep("", ncol(descript_comps) - 1)),
                        descript_comps[7:12, ])
```

```{r data1_measures_comps_tab, echo = FALSE, results = 'asis'}
# output gender comparison scale table
descript_comps %>%
  apa_table(caption      = "Descriptive statistics and sex differences for scales",
            col_spanners = list("\\textit{Mean} (\\textit{SD})" = c(2, 4)),
            stub_indents = list(which(descript_comps$Overall != "")),
            note         = "* \\textit{p} < .05, ** \\textit{p} < .01, *** \\textit{p} < .001.", 
            align        = c("l", "r", "r", "r", "r", "l", "r"),
            escape       = FALSE)
```

```{r data1_measures_sns}
# calculate the number of users by gender and sns
n_gen_sns <- data1 %>%
  mutate(great_0 = if_else(freq > 1, 1, 0)) %>%
  group_by(gender, sns) %>%
  summarise(great_0_sum = sum(great_0, na.rm = TRUE))

# drop sites with users < 20
low_use_sites <- n_gen_sns %>%
  ungroup() %>%
  filter(great_0_sum < 20) %>%
  select(sns) %>%
  mutate(sns = as.character(sns)) %>%
  flatten_chr() %>%
  unique()

data1 %<>%
  filter(!(sns %in% low_use_sites))

# calculate sns use descriptives for a table
descript_sns <- data1 %>%
  group_by(sns) %>%
  summarise(freq_mean = mean(freq, na.rm = TRUE),
            freq_sd   =   sd(freq, na.rm = TRUE),
            len_mean  = mean( len, na.rm = TRUE),
            len_sd    =   sd( len, na.rm = TRUE))

descript_sns <- data1 %>%
  filter(gender == "Female") %>%
  group_by(sns) %>%
  summarise(freq_mean_fem = mean(freq, na.rm = TRUE),
            freq_sd_fem   =   sd(freq, na.rm = TRUE),
            len_mean_fem  = mean( len, na.rm = TRUE),
            len_sd_fem    =   sd( len, na.rm = TRUE),
            n_fem         =    n()) %>%
  right_join(descript_sns, by = "sns")

descript_sns <- data1 %>%
  filter(gender == "Male") %>%
  group_by(sns) %>%
  summarise(freq_mean_mal = mean(freq, na.rm = TRUE),
            freq_sd_mal   =   sd(freq, na.rm = TRUE),
            len_mean_mal  = mean( len, na.rm = TRUE),
            len_sd_mal    =   sd( len, na.rm = TRUE),
            n_mal         =    n()) %>%
  right_join(descript_sns, by = "sns")

########################################################
### instance of parallel iteration # 3 (1 required) ####
########################################################

# calculate t, p, and d for frequency and length
sns_freq_tdp <- pmap_df(list(m1  = descript_sns$freq_mean_fem,
                             m2  = descript_sns$freq_mean_mal,
                             sd1 = descript_sns$freq_sd_fem,
                             sd2 = descript_sns$freq_sd_mal,
                             n1  = descript_sns$n_fem,
                             n2  = descript_sns$n_mal),
                        tdp_from_pars)

names(sns_freq_tdp) <- paste0(names(sns_freq_tdp), "_freq")

########################################################
### instance of parallel iteration # 4 (1 required) ####
########################################################

sns_len_tdp <- pmap_df(list(m1  = descript_sns$len_mean_fem,
                            m2  = descript_sns$len_mean_mal,
                            sd1 = descript_sns$len_sd_fem,
                            sd2 = descript_sns$len_sd_mal,
                            n1  = descript_sns$n_fem,
                            n2  = descript_sns$n_mal),
                       tdp_from_pars)

names(sns_len_tdp) <- paste0(names(sns_len_tdp), "_len")

descript_sns <- cbind(descript_sns, sns_freq_tdp, sns_len_tdp)

descript_sns %<>%
  mutate(ast_freq = p_to_ast(p_freq),
         ast_len  = p_to_ast(p_len))
  
# format composite descriptives for output
descript_sns %<>%
  mutate(`Overall`    = paste_msd(spround(freq_mean),     spround(freq_sd)),
         `Female`     = paste_msd(spround(freq_mean_fem), spround(freq_sd_fem)),
         `Male`       = paste_msd(spround(freq_mean_mal), spround(freq_sd_mal)),
         `Overall `   = paste_msd(spround(len_mean),      spround(len_sd)),
         `Female `    = paste_msd(spround(len_mean_fem),  spround(len_sd_fem)),
         `Male `      = paste_msd(spround(len_mean_mal),  spround(len_sd_mal))) %>%
  select(Site = sns, 
         Overall,
         Female,
         Male,
         `$t$` = t_freq,
         ` `   = ast_freq,
         `$d$` = d_freq,
         `Overall `,
         `Female `,
         `Male `,
         `$t$ ` = t_len,
         `  `   = ast_len,
         `$d$ ` = d_len) %>%
  mutate(Site = stringi::stri_trans_totitle(Site))

# split data into two
descript_sns_freq <- descript_sns[1:7]

descript_sns_len <- descript_sns[c(1, 8:13)]

```

```{r data1_measure_sns_freq_tab, echo = FALSE, results = 'asis'}
# output frequency table
descript_sns_freq %>%
  apa_table(caption      = "Descriptive statistics and sex differences for frequency of social media use.",
            col_spanners = list("\\textit{Mean} (\\textit{SD})" = c(2, 4)),
            note         = "* \\textit{p} < .05, ** \\textit{p} < .01, *** \\textit{p} < .001.", 
            align        = c("l", "r", "r", "r", "r", "l", "r"),
            escape       = FALSE)
```

```{r data1_measure_sns_len_tab, echo = FALSE, results = 'asis'}
# output length table
descript_sns_len %>%
  apa_table(caption      = "Descriptive statistics and sex differences for average length of social media use per day in minutes.",
            col_spanners = list("\\textit{Mean} (\\textit{SD})" = c(2, 4)),
            note         = "* \\textit{p} < .05, ** \\textit{p} < .01, *** \\textit{p} < .001.", 
            align        = c("l", "r", "r", "r", "r", "l", "r"),
            escape       = FALSE)

# drop unneeded variables
rm(list = setdiff(ls(), c("data1", "alphas", "data1_distinct", "table_count", "custom_functions", custom_functions)))
```

Participants completed an online survey that included (1) a measure of the Dark Triad personality traits (i.e., Machiavellianism, narcissism, psychopathy), (2) questions assessing  participants' frequency of visiting eleven social media sites, (3) questions assessing the amount of time participants spend on those eleven social media sites, (4) a scale assessing the participants' addiction to social media, (5) a scale measuring participants' reasons for using the internet, and (6) two questions assessing participants' overall view of social media sites. Participants provided consent prior to beginning the survey and were debriefed upon completion of the survey. For the purposes of the final project for Functional Programming in R, the following analyses will focus on the measures of the Dark Triad traits and the questions assessing frequency of use and amount of time spent on social media sites.

The Dark Triad was assessed using the Dirty Dozen [@Jonason2010d], comprising four items each for Machiavellianism ($\alpha$ = `r alphas["dd_mach"]`), narcissism ($\alpha$ = `r alphas["dd_narc"]`), and psychopathy ($\alpha$ = `r alphas["dd_psyc"]`). Participants responded using a 5-pt Likert scale (1 = "Strongly disagree"; 5 = "Strongly agree"). Descriptive statistics and gender comparisons for the Dark Triad traits, as well as the other scale measures, can be seen in Table `r (table_count <- table_count + 1)`.

Participants were also asked how frequently they visited 11 social media sites on a 5-pt scale (1 = "less often than every few weeks"; 5 = "several times a day"). The list of sites included Facebook, Instagram, LinkedIn, Twitter, Snapchat, YouTube, WhatsApp, Reddit, 4chan, and Tumblr. However, certain sites were only used be women (e.g., Pinterest) or men (e.g., 4chan). Additional sites included users from both genders, but in an amount that would lead to misinterpretations. We dropped sites with fewer than 20 participants reporting visiting the site at least every few weeks from the analysis from either gender. In the end, we retained frequency of use ratings for Facebook, Instagram, Reddit, Snapchat, Twitter, and YouTube. The descriptive statistics and gender comparisons for those sites can be seen in Table `r (table_count <- table_count + 1)`. We also asked participants the average number of minutes they spend on each site on an average day. Again, we only retained those sites that had more than 20 at-least-rare users of both genders. For the descriptive statistics and gender comparisons for the average length of time in minutes spent on those sites per day, see Table `r (table_count <- table_count + 1)`. 

# Results and Discussion
```{r data1_zeroorder, include = FALSE}
# set the data up for the correlation matrix
data1_corr <- data1 %>%
  spread(sns_perc_context, sns_perc_rating) %>%
  select(id, freq, len, sns) %>%
  gather(unit, value, c(freq, len)) %>%
  unite(temp, unit, sns) %>%
  spread(temp, value)

# calculate average frequency and total minutes spent on sns accross all sites
data1_corr$sns_freq_avg <- str_composite("freq_", data1_corr)
data1_corr$sns_len_sum  <- str_composite("len_", data1_corr, sum = TRUE)

# tidy data for zero order analsis
data1_corr %<>%
  select(id, sns_freq_avg, sns_len_sum) %>%
  left_join(data1, by = "id") %>%
  distinct(id, .keep_all = TRUE) %>%
  select(sns_freq_avg,
         sns_len_sum,
         gender,
         starts_with("dd")) 

# create a female correlation table
zo_fem <- data1_corr %>%
  filter(gender == "Female") %>%
  select(-gender) %>%
  corr.test()

# create a male correlaation table
zo_mal <- data1_corr %>%
  filter(gender == "Male") %>%
  select(-gender) %>%
  corr.test()
  
# create a zero-order correlation table to write over; has the additional 
# benefit of preallocating the memory
zo <- zo_fem$r

# iterate over the rows of the correlation table
for (i in 1:nrow(zo)) {
  # iterate over the columns of the correlation table
  for (j in 1:ncol(zo)) {
    # if we are in the bottom quadrant of the table, pull from the male table
    if (i / j > 1) {
      # round the r to two decimal places
      r <- spround(zo_mal$r[i, j])
      # pull the p from the upper quadrant of the male table to get holm 
      # adjusted values and replace them with asterisks
      p <- p_to_ast(zo_mal$p[j, i])
      # paste the r and asterisks together and place in the correlation matrix
      zo[i, j] <- paste(r, p, sep = "")
    # if we are in the upper quadrant of the table, pull from the female table
    } else {
      # round the r to two decimal places
      r <- spround(zo_fem$r[i, j])
      # pull the holm-adjusted ps from the table and replace with asterisks
      p <- p_to_ast(zo_fem$p[i, j])
      # paste the r and asterisks together and place in the correlation matrix
      zo[i, j] <- paste(r, p, sep = "")
    }
  }
}

# rename columns and headers
colnames(zo) <- seq_len(ncol(zo))
rownames(zo) <- c("1. SNS Frequency",
                  "2. SNS Length",
                  "3. Machiavellianism",
                  "4. Narcissism",
                  "5. Psychopathy")

# replace the diagonal correlations with hyphens
zo[zo == "1.00***"] <- "-"
```

```{r data1_zeroorder_tab, echo = FALSE, results = 'asis'}
# print table
zo %>%
  apa_table(caption = "Zero-order correlations with frequency of social media use, length spent on social media per day, and the Dark Triad traits.",
            note = paste0("* \\textit{p} < .05, ** \\textit{p} < .01, *** \\textit{p} < .001. Values above the diagonal are for women (\\textit{n} = ",
                          median(zo_fem$n),
                          "); values below the diagonal are for men (\\textit{n} = ",
                          median(zo_mal$n),
                          "). P-values were adjusted using the Holm-Bonferonni method and were adjusted separately for the male and female sub-samples. Frequency of social media use and length spent on social media were collapsed accross all sites."),
            align = "l",
            escape = FALSE)

# drop unneeded variables
rm(list = setdiff(ls(), c("data1", "table_count", "custom_functions", custom_functions)))
```

Zero-order correlations among all variables are shown in Table `r (table_count <- table_count + 1)`. Collapsing across the social media sites, there appears to be no relationship between the Dark Triad traits and either the frequency of social media use or the average length of time spent on social media per day. In order to leverage the multiple observations gathered for every participant, we opted to run two series of linear mixed-effects models. The predictors and the sequence of adding those predictors to the models for each series was identical. The series only differed by outcome variable: The first model had frequency of visiting social media as an outcome variable, while the second model had length of social media use per day (in minutes) as the outcome variable.

```{r data1_lmer_freq, include = FALSE}
# filter data1 for NAs
data1 %<>%
  filter(!is.na(dd_mach_comp),
         !is.na(dd_narc_comp),
         !is.na(dd_psyc_comp),
         !is.na(freq))

# grand-mean center dark triad traits
data1 %<>%
  mutate_at(vars(starts_with("dd")), scale, scale = FALSE)

# fit unconditional model
model_freq_0 <- lmer(freq ~ (1 | id), data = data1, REML = FALSE)

# calculate ICCs from unconditional model
freq_icc <- icc(model_freq_0)

# fit gender model
model_freq_1 <- lmer(freq ~ gender + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with the dark triad traits
model_freq_2 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with sns
model_freq_3 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender X d3 interaciton
model_freq_4 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender x sns interaction
model_freq_5 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with d3 x sns interaction
model_freq_6 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            dd_mach_comp * sns + 
                            dd_narc_comp * sns +
                            dd_psyc_comp * sns + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with d3 x sns x gender interaction
model_freq_7 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            dd_mach_comp * sns + 
                            dd_narc_comp * sns +
                            dd_psyc_comp * sns + 
                            dd_mach_comp * sns * gender + 
                            dd_narc_comp * sns * gender +
                            dd_psyc_comp * sns * gender + 
                            (1 | id), data = data1, REML = FALSE)

# compare models
freq_model_comp <- anova(model_freq_0,
                         model_freq_1,
                         model_freq_2,
                         model_freq_3,
                         model_freq_4,
                         model_freq_5,
                         model_freq_6,
                         model_freq_7)

# respecify model (drop gender x d3 interactions)
model_freq_final <- lmer(freq ~ gender + 
                                dd_mach_comp + 
                                dd_narc_comp +
                                dd_psyc_comp + 
                                sns +
                                gender * sns +
                                dd_mach_comp * sns + 
                                dd_narc_comp * sns +
                                dd_psyc_comp * sns + 
                                dd_mach_comp * sns * gender + 
                                dd_narc_comp * sns * gender +
                                dd_psyc_comp * sns * gender +
                                (1 | id), data = data1, REML = FALSE)

# summarize final model
model_freq_final_sum <- summary(model_freq_final)

```

```{r data1_lmer_len, include = FALSE}
# fit unconditional model
model_len_0 <- lmer(len ~ (1 | id), data = data1, REML = FALSE)

# calculate ICCs for unconditional model
len_icc <- icc(model_len_0)

# fit gender model
model_len_1 <- lmer(len ~ gender + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with the dark triad traits
model_len_2 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with sns
model_len_3 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender X d3 interaciton
model_len_4 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender x sns interaction
model_len_5 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with d3 x sns interaction
model_len_6 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            dd_mach_comp * sns + 
                            dd_narc_comp * sns +
                            dd_psyc_comp * sns + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with d3 x sns x gender interaction
model_len_7 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            dd_mach_comp * sns + 
                            dd_narc_comp * sns +
                            dd_psyc_comp * sns + 
                            dd_mach_comp * sns * gender + 
                            dd_narc_comp * sns * gender +
                            dd_psyc_comp * sns * gender + 
                            (1 | id), data = data1, REML = FALSE)

# compare models
len_model_comp <- anova(model_len_0,
                        model_len_1,
                        model_len_2,
                        model_len_3,
                        model_len_4,
                        model_len_5,
                        model_len_6,
                        model_len_7)

# respecify model (drop gender x d3 interactions)
model_len_final <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * sns +
                            dd_mach_comp * sns + 
                            dd_narc_comp * sns +
                            dd_psyc_comp * sns + 
                            dd_mach_comp * sns * gender + 
                            dd_narc_comp * sns * gender +
                            dd_psyc_comp * sns * gender + 
                            (1 | id), data = data1, REML = FALSE)

# summarize final model
model_len_final_sum <- summary(model_len_final)

```

In terms of random effects, we allowed intercepts to vary accross subjects. It would have also been defensible to run the model as a two-level cross-classified model, nesting observations within both subjects and social media sites. However, we were interested in the effects of specific social media sites and thus included them as fixed effects in our model. In the present case, grouping by subject explained `r spround(freq_icc * 100)`% of the variation in frequency of social media use and `r spround(len_icc * 100)`% of the variation in the length of social media use before addition of any fixed effect predictors. We added fixed effects to our model in the following order: (1) gender, (2) the Dark Triad traits, (3) the specific social media site, (4) the interaction between gender and the Dark Triad traits, (5) the interaction between gender and the social media sites, (6) the interaction between the Dark Triad traits and the  social media sites, and, finally, (7) the three-way interaction between the Dark Triad traits, social media sites, and gender. Results of the model comparisons can be see in Table `r (table_count <- table_count + 1)`. Since the three-way interaction significantly improved model fit for the length of social media use model, we retained all predictors. Although the three-way model for the frequency of visiting social media only marginally improved model fit, we retained all predictors to allow for easy comparison accross both series of models.

The final, interpreted model was

$L1: Y_{ij} = \beta_{0j} + \beta_{1j}SMS_{ij} + r_{ij}$

$L2: \beta_{0j} = \gamma_{00} + \gamma_{01}G{j} + \gamma_{02}M{j} + \gamma_{03}N_{j} + \gamma_{04}P_{j} + \gamma_{05}G_{j}*M_{j} + \gamma_{06}G_{j}*N_{j} + \gamma_{07}G_{j}*P_{j}  + u_{0j}$

$\;\;\;\;\;\;\; \beta_{1j} = \gamma_{10} + \gamma_{11}G{j} + \gamma_{12}M_{j} + \gamma_{13}N_{j} + \gamma_{14}P_{j} + \gamma_{15}G_{j}*M_{j} + \gamma_{16}G_{j}*N_{j} + \gamma_{17}G_{j}*P_{j} + u_{1j}$

with $Y_{ij}$ representing frequency visiting social media sites and length spent on social media use for each respective series of model comparisons. 

```{r model_interpretation, eval = FALSE, include = FALSE}
model_freq_final_sum

# First, an examiniation of social media sites revealed that relative to Facebook, participants in general reported using Instagram [*b* = .81, *SE* = .20, *t*(1571.11) = 4.10, *p* < .001], Snapchat [*b* = 1.01, *SE* = .20, *t*(1571.11) = 5.11, *p* < .001], and Youtube [*b* = 1.31, *SE* = .20, *t*(1571.11) = 6.64, *p* < .001] more. Reddit was used less frequently than Facebook [*b* = -1.23, *SE* = .23, *t*(1571.11) = -5.31, *p* < .001], and there were no significant differences between Facebook and Instagram (*p* > .35). 

model_len_final_sum
```

## Frequency of Visting Social Media Sites

Results revealed that compared to males, females tended to visit social media sites more frequently, overall, *b* = 0.45, *SE* = .19, *t*(791.03) = 2.30, *p* = .022. However, males appeared to visit Reddit [*b* = 1.23, *SE* = .23, *t*(1571.11) = 5.31, *p* < .001] and Youtube [*b* = 1.07, *SE* = .23, *t*(1571.11) = 4.62, *p* < .001] more frequently than females. 

In regard to the Dark Triad traits, those higher in narcissism reported visiting Instagram [*b* = .79, *SE* = .31, *t*(1571.11) = 2.56, *p* = .011] and Snapchat [albeit marginally; *b* = .56, *SE* = .31, *t*(1571.11) = 1.81, *p* = .07] more frequently than Facebook. Interestingly, it appears this effect of Narcissism on Instagram use interacted with gender, such that female narcissists visited Instagram less than male narcissists, *b* = -0.79, *SE* = .35, *t*(1571.11) = -2.27, *p* = .023. Those high in Machiavellianism, on the other hand, visited Reddit more than Facebook, *b* = .85, *SE* = .30, *t*(1571.11) = 2.84, *p* = .004. This effect again depended on gender. That is, females high in Machiavellianism  visited Reddit less than males high in Machiavellianism, *b* = -0.92, *SE* = .38, *t*(1571.11) = -2.39, *p* = .017. Finally, the only effect to arise concerning psychopathy was an interaction between psychopathy, gender, and social media site. Specifically, females scoring higher in psychopathy reported visiting Reddit more than Facebook, *b* = .84, *SE* = .42, *t*(1571.11) = 1.99, *p* = .047.

## Length of Social Media Use (in minutes)

While females tended to visit social media sites more overall, analyzing the total time spent on social media per day (in minutes) revealed males and females did not significantly differ from one another in overall time spent on social media (*p* > .29). Results similarly indicated that males appeared to report spending more minutes per day on Reddit [*b* = 25.63, *SE* = 8.09, *t*(11552.29) = 3.17, *p* = .002] and Youtube [*b* = 37.96, *SE* = 8.09, *t*(11552.29) = 4.69, *p* < .001].

Examining the Dark Triad traits revealed that when compared to time spent on Facebook, those higher in narcissism reported spending less minutes per day on Reddit [*b* = -23.23, *SE* = 10.70, *t*(1551.95) = -2.17, *p* = .030] and--marginally--Youtube, *b* = -19.29, *SE* = 10.70, *t*(1551.95) = -1.80, *p* = .07. The influence of narcissism on time spent on Reddit each day depended on one's gender. Female narcissists spent more time on Reddit than male narcissists, *b* = 22.09, *SE* = 12.14, *t*(1552.04) = 1.82, *p* = .07. Though, this effect only approached conventional levels of signifcance, meaning the result should be interpreted with caution.

Conversely, those high in Machiavellianism spent significantly less minutes per day on Youtube  [*b* = -25.28, *SE* = 10.38, *t*(1551.95) = -2.44, *p* = .015] and marginially less minutes per day on Twitter, *b* = -18.79, *SE* = 10.38, *t*(1551.95) = -1.81, *p* = .07. Though, both of these effects changed as a function of gender, such that females high in Machiavellianism actually spent more time per day on Youtube [*b* = 24.44, *SE* = 13.35, *t*(1552.71) = 1.83, *p* = .07] and Twitter [*b* = 25.33, *SE* = 13.36, *t*(1552.99) = 1.90, *p* = .06] than males high in  Machiavellianism. Again, we should note these interactions with gender were only approaching conventional levels of significance.

Lastly, results suggested those high in psychopathy spent more minutes per day on Youtube than Facebook, *b* = 36.53, *SE* = 12.23, *t*(1551.95) = 2.99, *p* = .003. This finding also appeared to depend on gender, such that female psychopaths spent less time on Youtube than male psychopaths, *b* = -34.66, *SE* = 14.77, *t*(1552.99) = -2.35, *p* = .019.

```{r data1_model_comps_tab, echo = FALSE, results = 'asis'}
# format column names for outputting
freq_model_comp %<>%
  select(`$df$` = Df,
         `$\\chi^2 df$` = `Chi Df`,
         AIC:logLik,
         `$\\chi^2$` = Chisq,
         `$p$` = `Pr(>Chisq)`)

len_model_comp %<>%
  select(`AIC ` = AIC,
         `BIC ` = BIC,
         `logLik ` = logLik,
         `$\\chi^2$ ` = Chisq,
         `$p$ ` = `Pr(>Chisq)`)

# combine tables
model_comps_comb <- cbind(freq_model_comp, len_model_comp)

########################################################
### instance of parallel iteration # 4 (1 required) ####
########################################################

# round table columns to appropriate number of digits
model_comps_comb <- pmap_df(list(model_comps_comb, 
                                 c(0, 0, 2, 2, 2, 2, 3, 2, 2, 2, 2, 3), 
                                 c(rep(TRUE, 2), rep(c(rep(TRUE, 4), FALSE), 2))),
                            ~spround(x = ..1, digits = ..2, leading0 = ..3))

# add a new column with the predictors added in each subsequent models
model_comps_comb$Model <- c("Null",
                            "Gender (G)",
                            "Dark Triad (D3)",
                            "Social Media (SNS)",
                            "G X D3",
                            "G X SNS",
                            "D3 X SNS",
                            "G X D3 X SNS")

# reorder the data frame so the predictors are first
model_comps_comb %<>%
  select(Model,
         everything())

# iterate over entire table and replace .000s with <.000s
model_comps_comb <- apply(model_comps_comb, 
                          MARGIN = c(1, 2), 
                          function(string) gsub(".000", "<.001", string))

# iterate over entire table and replace NAs with nothing
model_comps_comb <- apply(model_comps_comb, 
                          MARGIN = c(1, 2), 
                          function(string) gsub("NA", "", string))

# output the model comparison table
model_comps_comb %>%
 apa_table(caption = "Log likelihood comparison of linear mixed-effects models predicting frequency of visiting social media sites and length of time spent on social media sites.",
           escape = FALSE,
           align = "lrrrrrrrrrrrr",
           landscape = TRUE,
           col_spanners = list("Frequency" = c(4, 8),
                               "Length"    = c(9, 13)),
           note = "All models were fit using Full Maximal Likelihood estimation. Intercepts varied among participants. ")

```


```{r fig.cap="Average length spent on social media per day (in minutes) as a function of Machiavellianism and social media site."}
# convert dark triad traits to categorical using the con_to_cat function
data1$mach_group <- con_to_cat(data1$dd_mach_comp)
data1$narc_group <- con_to_cat(data1$dd_narc_comp)
data1$psyc_group <- con_to_cat(data1$dd_psyc_comp)

# create academic inspired theme
academic_theme <- theme(plot.subtitle = element_text(family = "Times"), 
                        plot.caption  = element_text(family = "Times", 
                                                     size   = 12,
                                                     hjust  = 0), 
                        axis.title    = element_text(family = "Times", 
                                                     face   = "bold"), 
                        axis.text     = element_text(family = "Times"), 
                        axis.text.x   = element_text(family = "Times"), 
                        axis.text.y   = element_text(family = "Times"), 
                        plot.title    = element_text(family = "Times", 
                                                     face   = "bold"), 
                        legend.text   = element_text(family = "Times"), 
                        legend.title  = element_text(family = "Times"), 
                        strip.text    = element_text(family = "Times",
                                                     face   = "bold"))

# making social media site title case
data1 %<>%
  mutate(sns = stringr::str_to_title(sns))

# examining whether social media use differ as a function of Machiavellianism
plot1_mach <- data1 %>%
  filter(mach_group != "Mid") %>% 
  group_by(sns, mach_group) %>%
  summarize(len_m  = mean(len, na.rm = TRUE),
            len_se = sundry::se(len)) %>%
  ggplot(aes(x = mach_group, y = len_m, fill = mach_group)) +
    geom_col(position = "dodge", alpha = 0.75) +
    geom_errorbar(aes(ymin = len_m - len_se, 
                      ymax = len_m + len_se),
                  position = "dodge",
                  colour   = "grey30") +
    scale_fill_manual(values = c("#4A235A", "#D2B4DE")) +
    facet_wrap(~sns) +
    theme_bw(base_size = 14) +
    guides(fill = FALSE) +
    labs(y = "Average length spent on Social \nMedia Sites per Day (minutes)",
         x = "Machiavellianism")

# format the plot using the academic theme
plot1_mach + academic_theme
```

```{r fig.cap="Average length spent on social media per day (in minutes) as a function of Narcissism and social media site."}
#Examining whether social media use differ as a funciton of Narcissism (no gender)
plot1_narc <- data1 %>%
  filter(narc_group != "Mid") %>%
  group_by(sns, narc_group) %>% 
  summarize(len_m  = mean(len, na.rm = TRUE),
            len_se = sundry::se(len)) %>%
    ggplot(aes(x = narc_group, y = len_m, fill = narc_group)) +
    geom_col(position = "dodge", alpha = 0.75) +
    geom_errorbar(aes(ymin = len_m - len_se, 
                      ymax = len_m + len_se),
                  position = "dodge",
                  colour   = "grey30") +
    scale_fill_manual(values = c("#17737B", "#5FCDD6")) +
    facet_wrap(~sns) +
    guides(fill = FALSE) +
    theme_bw(base_size = 14) +
    theme(axis.title   = element_text(face = "bold"),
          strip.text   = element_text(face = "bold", size = 14),
          legend.title = element_text(face = "bold")) +
    labs(y = "Average length spent on Social \nMedia Sites per Day (minutes)",
         x = "Narcissism")

# format the plot using the academic theme
plot1_narc + academic_theme
```

```{r fig.cap="Average length spent on social media per day (in minutes) as a function of Psychopathy and social media site."}
#Examining whether social media use differ as a funciton of Psychopathy (no gender)
plot1_psyc <- data1 %>%
  filter(psyc_group != "Mid") %>%
  group_by(sns, psyc_group) %>% 
  summarize(len_m  = mean(len, na.rm = TRUE),
            len_se = sundry::se(len)) %>%
  ggplot(aes(x = psyc_group, y = len_m, fill = psyc_group)) +
    geom_col(position = "dodge", alpha = 0.75) +
    geom_errorbar(aes(ymin = len_m - len_se, 
                      ymax = len_m + len_se),
                  position = "dodge",
                  colour   = "grey30") +
    scale_fill_manual(values = c("#7B1740", "#D1769B")) +
    facet_wrap(~sns) +
    guides(fill = FALSE) +
    theme_bw(base_size = 14) +
    theme(axis.title   = element_text(face = "bold"),
          strip.text   = element_text(face = "bold", size = 14),
          legend.title = element_text(face = "bold")) +
    labs(y = "Average length spent on Social \nMedia Sites per Day (minutes)",
         x = "Psychopathy") 

# format the plot using the academic theme
plot1_psyc + academic_theme
```

```{r fig.cap="Average length spent on social media per day (in minutes) as a function of gender and social media site."}
# examining gender differences in minutes spent on social media each day 
# as a function of social media site
plot1_gender <- data1 %>%
  group_by(gender, sns) %>%
  summarise(len_m = mean(len, na.rm = TRUE),
            len_se = se(len, na.rm = TRUE)) %>%
  ggplot(aes(x = sns, y = len_m, fill = gender)) + 
    geom_col(position = "dodge", alpha = 0.75) +
    scale_fill_manual(values = c("#633974", "#2A99A2"),
                      name = "Gender") +
    theme_bw(base_size = 14) +
    theme(axis.title = element_text(face = "bold"),
          strip.text = element_text(face = "bold", size = 14),
          legend.title = element_text(face = "bold")) +
    coord_flip() +
    labs(y = "Average Length Spent on Social Media Sites per Day (minutes)",
         x = "Social Media Site")

# format the plot using the academic theme
plot1_gender + academic_theme
```

```{r gender_parallel_iteration, warning = FALSE, include = FALSE}

########################################################
### instance of parallel iteration # 5 (1 required) ####
## instance of purr::nest%>%mutate() # 1 (1 required) ##
########################################################

# for those who are curious: 
#let's examine whether gender effects on sns use vary as a function of the dark triad traits
#these figures will not appear in the manuscript
#instead, the figures will be saved in a folder called "plots"

plot_data <- data1 %>%
  gather(key = dd_trait, value = standing, mach_group:psyc_group) %>%
  mutate(dd_trait = recode(dd_trait,
                           "mach_group" = "Machiavellianism",
                           "narc_group" = "Narcissism",
                           "psyc_group" = "Psychopathy"))
  
plot_data$standing <- factor(plot_data$standing, levels = c("Low", "Mid", "High"))

plot_data %<>%
  filter(standing != "Mid") %>%
  spread(sns_perc_context, sns_perc_rating) %>%
  group_by(dd_trait, standing) %>%
  nest()

final_plots <- plot_data %>%
  mutate(plots = pmap(
    # create list of plot resources
    list(data_for_plot = plot_data$data,
         dd_trait      = plot_data$dd_trait, 
         standing      = plot_data$standing),
    # create plots
    function(data_for_plot, dd_trait, standing) {
      ggplot(data_for_plot, aes(x = gender, y = len, fill = gender)) +
        geom_col(position = "dodge") +
        scale_fill_manual(values = c("#633974", "#2A99A2")) +
        # apply theme minimal
        theme_bw(base_size = 12) +
        guides(fill = FALSE) +
        facet_wrap(~sns) +
        #scale_color_manual(values = c("#17737B", "#5FCDD6")) +
        theme(axis.title      = element_text(face = "bold"),
              legend.title    = element_text(face = "bold"),
              title           = element_text(face = "bold"),
              strip.text      = element_text(face = "bold"),
              legend.position = "bottom") +
        # set labels
        labs(title = glue("Relation Between Time on Social Media and Gender for those {standing} in {dd_trait}"),
             y     = "Total Time Spent on Social Media \nSites per Day (Minutes)",
             x     = "Gender")
}))

final_plots$plots[[1]]
final_plots$plots[[2]]
final_plots$plots[[3]]
final_plots$plots[[4]]
final_plots$plots[[5]]
final_plots$plots[[6]]

# create a name for the plot files
final_plots %<>%
  mutate(file_name = paste(dd_trait, standing, sep = "_"),
         file_name = gsub(" ", "_", file_name),
         file_name = tolower(file_name),
         file_name = glue("{file_name}.png"))

# create a plots directory
fs::dir_create(here::here("plots"))

# create file paths
paths <- here::here("plots", final_plots$file_name)

#######################################################################
#{purrr} function outside the basic map family (walk_*) # 1[10 points]#
# One Required                                                        #
#######################################################################

# walk the plots and save using the paths
walk2(paths, final_plots$plots, ggsave,
      # specify image dimensions and resolution
      width  = 9.5, 
      height = 6.5,
      dpi    = 500)

```

\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
