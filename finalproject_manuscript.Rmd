---
title             : "The dark (and light) side of social media"
shorttitle        : "The dark (and light) side of social media"

author: 
  - name          : "Cameron S. Kay"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Psychology, 1227 University of Oregon, Eugene, OR 97403"
    email         : "ckay@uoregon.edu"
  - name          : "Ashley L. Miller"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  Cameron Stuart Kay, Department of Psychology, University of Oregon; Ashley L. Miller, Department of Psychology, University of Oregon.

abstract: |
 Abstract goes here.
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

header-includes:
  - \raggedbottom
  - \setlength{\parskip}{0pt}

documentclass     : "apa6"
classoption       : "man, fleqn, noextraspace"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
# install packages if you do not have them installed already
# devtools::install_github("datalorax/sundry")
# install.packages("papaja")
# install.packages("tidyverse")
# install.packages("rio")
# install.packages("here")
# install.packages("magrittr")
# install.packages("lme4")
# install.packages("lmerTest")
# install.packages("psych")
# install.packages("glue")
# install.packages("sjstats")

# load packages
library(sundry) # for calculating standard errors
library("papaja") # for creating the apa journal article
library(tidyverse) # for purrr, dplyr, and ggplot2 functions
library(rio) # for easy imporrting of data
library(here) # for reproducible paths
library(magrittr) # for the compound assigiment pipe-operator
library(lme4) # for conducting linear mixed-effects models
library(lmerTest) # for calculating t-tests for linear mixed-effects models
library(psych) # for caculating cronbach's alpha
library(glue) # for gluing together strings during parallel iteration
library(sjstats) # for caalculating betas

# set a table incrementer (the papaja table referencer is not working for me)
table_count <- 0

# source custom functions (the rmarkdown document is unwieldy otherwise)
source(here("functions", "str_cols_find.R")) # CUSTOM FUNCTION 1: for extracting
                                             # columns from a dataframe using a 
                                             # string
source(here("functions", "name_creator.R"))  # CUSTOM FUNCTION 2: for creating
                                             # variable names given strings
source(here("functions", "range_mean.R"))    # CUSTOM FUNCTION 3: create a 
                                             # function for calculating the mean 
                                             # of a time response given as a 
                                             # character range. Example: "like 
                                             # 3-5 hours a day" would become "4"
source(here("functions", "str_alpha.R"))     # CUSTOM FUNCTION 4: for 
                                             # calculating cronbach's alpha for
                                             # columns that match a string
source(here("functions", "str_composite.R")) # CUSTOM FUNCTION 5: for 
                                             # calculating rowmeans for
                                             # columns that match a string
source(here("functions", "spround.R"))       # CUSTOM FUNCTION 6: for rounding 
                                             # and formatting for printing in 
                                             # one step
source(here("functions", "perble.R"))        # CUSTOM FUNCTION 7: for creating a
                                             # a table with the percentages
source(here("functions", "lenique.R"))       # CUSTOM FUNCTION 8: calculates the
                                             # length of unique values
source(here("functions", "con_to_cat.R"))    # CUSTOM FUNCTION 9: quantile 
                                             # splits a numeric column
source(here("functions", "paste_msd.R"))     # CUSTOM FUNCTION 10: for combining
                                             # a mean and sd for a table
source(here("functions", "p_to_ast.R"))      # CUSTOM FUNCTION 11: for creating
                                             # a vector of asterisks from a 
                                             # vector of p-values
source(here("functions", "tdp_from_pars.R")) # CUSTOM FUNCTION 12: for 
                                             # calculating t, d, and p from
                                             # the calculated mean, sd, and n


# create a vector of the custom functions
custom_functions <- objects()

# import data as tibble and clean column names
data1 <- rio::import(here::here("data", "data_1.xlsx"), setclass = "tibble") %>%
  janitor::clean_names()

# turn off scientific notation
options(scipen = 999)
```

```{r data1_rename, include = FALSE}
# drop the display order columns and the custom demographic columns
data1 %<>%
  select(-contains("do"),
         -contains("text"))

# manualy rename the demographic columns
data1 %<>%
  rename(age          = q1_1,
         gender       = q1_2,
         race         = q1_4)


# create vectors of subscale names
dd_subs  <- c("mach", "narc", "psyc") # subscales for the dirty dozen scale

sns_subs <- c("facebook", # subscales for the frequency and length of sns use 
              "pinterest", 
              "instagram", 
              "linkedin", 
              "twitter", 
              "snapchat", 
              "youtube", 
              "whatsapp", 
              "reddit", 
              "4chan", 
              "tumblr")

con_subs <- c("society", # subscales for questions assessing benefit of sns
              "self")
 
mot_subs <- c("inform", # subscales for the motivations to use the internet 
              "interp", # scale
              "entert")
 
add_subs <- c("salience", # susbscales for the internet addiction scale
              "tolerance",
              "mood",
              "relapse",
              "withdraw",
              "conflict")

# create a tibble containing all the necessary information for renaming the 
# columns
data_rename <- tibble(
                      # the scale names
                      scale_names = c("dd", 
                                      "freq",
                                      "len",
                                      "sns_perc",
                                      "int_mot",
                                      "int_addict"),
                      # the scale subscales created above
                      sub_names   = list(dd_subs,
                                         sns_subs,
                                         sns_subs,
                                         con_subs,
                                         mot_subs,
                                         add_subs),
                      # the total length of the scales
                      scale_lens  = c(12, 11, 11, 2, 20, 18),
                      # the length of the subscales (only one value if all are 
                      # the same length)
                      sub_lens    = list(4, 1, 1, 1, c(8, 7, 5), 3))

# iterate through the data_rename tibble and create a list of column names
col_names <- pmap(list(data_rename$scale_names,
                       data_rename$sub_names,
                       data_rename$scale_lens,
                       data_rename$sub_lens),
                  ~name_creator(..1, ..2, ..3, ..4)
)

# assign created column names to data1
names(data1)[str_cols_find("q7", data1)] <- unlist(col_names)

# remove uneeded variables
rm(list = setdiff(ls(), c("data1", "col_names", "custom_functions", custom_functions)))
```

```{r data1_convert_to_long, include = FALSE}
# add an id column to the data
data1 %<>%
  mutate(id = 1:n()) %>%
  select(id, everything())

# transform the data to long format with respect the the frequency of sns use 
# and the length of sns use
data1 %<>%
  # over gather all frequency and length columns
  gather("key", "value", freq_facebook:len_tumblr) %>%
  # separate the key columns into a column specifying freq/length and a column
  # specifying the social media site
  separate(key, into = c("variable", "sns"), sep = "_") %>%
  # spread the frequency and length column into two separate columns
  spread(variable, value)

# transform the data to long format with respect to perception of sns
data1 %<>%
  # gather the two columns (i.e., benefit of sns to the self and benefit of sns
  # to society)
  gather("sns_perc_context", "sns_perc_rating", starts_with("sns_perc")) %>%
  # drop all text before "self" or "society
  mutate(sns_perc_context = gsub(".*_", "", sns_perc_context))

```

```{r data1_parse_length, include = FALSE}
# identify the units responses were given in (even though I specifically 
# requested that the responses be provided in  minutes)
data1 %<>%
  mutate(len_unit  = case_when(grepl("(hour|hr)", len) ~ 60,
                               TRUE                    ~ 1))

#######################################################
#### Variant of purr::map #1 (at least 2 required) ####
#######################################################

# replace all range responses with the means of those ranges
data1$len <- map_chr(data1$len, range_mean)

# parse the numbers
data1 %<>%
  mutate(# replace written numbers with arabic numerals
         len = case_when(len == "ten"                  ~ "10",
                         len == "3o"                   ~ "30",
                         len == "sixty"                ~ "60",
                         len == "eighty"               ~ "80",
                         grepl("(zero|no|never)", len) ~ "0",
                         TRUE                          ~ len),
         # parse the numbers
         len = parse_number(len),
         # calculate the length in minutes by multipling the unit by the length
         len = len * len_unit) %>%
         # drop the unit column
         select(-len_unit)
```

```{r data1_format, include = FALSE}
# factorize and label factors
data1 %<>%
  mutate(# factorize gender and apply labels
        gender           = factor(gender, labels = c("Male",
                                                     "Female",
                                                     "Non-binary",
                                                     "Prefer not to say",
                                                     "Other")),
        # factorize race and apply labels
        race             = factor(race, labels   = c("American Indian or Alaska Native",
                                                     "Asian",
                                                     "Black or African American",
                                                     "Native Hawaiian or Other Pacific Islander",
                                                     "Caucasian",
                                                     "Hispanic, Latinx, or Spanish Origin",
                                                     "Middle Eastern or North African",
                                                     "I prefer not to answer",
                                                     "Some other ethnicity or origin")),
        # factorize social media site
        sns              = factor(sns),
        # factorize context
        sns_perc_context = factor(sns_perc_context),
        # numerize frequency
        freq             = as.numeric(freq))

```

```{r data1_composites, include = FALSE}
# drop column names not to be made into composites
comp_names <- col_names[-2:-4]

#######################################################
#### Variant of purr::map #2 (at least 2 required) ####
#######################################################

# drop item identifiers (e.g., "dd_7") to create the composite names; retain 
# only unique names (e.g., "dd")
comp_names %<>%
  map(str_replace, "_\\d", "") %>%
  map(unique)


#######################################################
#### Variant of purr::map #3 (at least 2 required) ####
#######################################################

# calculate alphas for the composites 
alphas <- comp_names %>%
  map(map_dbl, str_alpha, data = data1, full = FALSE) %>%
  flatten_dbl() 

# name the alpha composites
names(alphas) <- flatten_chr(comp_names)

#######################################################
#### Variant of purr::map #4 (at least 2 required) ####
#######################################################

# create composites
data_comp <- comp_names %>%
  map(map, str_composite, data1) %>%
  flatten_dfc()

# assign names to the created composites
names(data_comp) <- paste0(flatten_chr(comp_names), "_comp")

# combine the composites with the existing dataframe
data1 <- data1 %>%
  cbind(data_comp)

# clean up the environment
rm(list = setdiff(ls(), c("data1", "alphas", "custom_functions", custom_functions)))
```

# Intro

In 2005—one year before Facebook became publicly accessible—only 5% of American adults reported using at least one social media site [@Smith2018a]. Thirteen-years later, in 2018, that number had risen to include 69%, or roughly two-thirds, of American adults. It would be hard to argue there hasn’t been a profound increase in the number of Americans using social media, but this 69% figure does vary depending on age bracket. As one might expect, over twice as many 18-to-29 year-olds reported using social media when compared to those older than 65 (88% and 37%, respectively). The population variation was not restricted to age, however: Eight percent more women used social media than men and 16% more people from urban communities used social media than their non-urban counterparts. Recently, psychologists have turned to personality traits to explain some of the remaining variance in social media use. 

With some notable exceptions, the research conducted in the overlapping region between personality and communications has focused primarily on ostensibly positive personality traits. Negative personality traits have been left largely unexplored. Given previous, albeit sparse, research, it does appear there may be a relationship between negative personality traits and social media use. The present study aims to address the paucity of research. To that end, we administered a survey assessing an individual’s levels of the Dark Triad personality traits (i.e., Machiavellianism, narcissism, and psychopathy), the amount of time he or she actively spends on social media sites, and the frequency with which he or she visits social media sites.
Background

A common definition for a social media site is that it is an internet-based service allowing for the creation and broadcast of user-generated information [@Boyd2008; @Kaplan2010; @Obar2015]. @Obar2015 emphasize the user-generated aspect of this definition, arguing that this content is the lifeblood of social media. Although this is a substantial claim, it logically follows that if a site is created with the express purpose of providing user-generated content, it must have user-generated content to function as intended. By way of illustration, without videos created by users, YouTube, a social media site that allows its users to upload and share videos, would fail to serve its primary purpose. Netflix, a site that allows users to only stream videos, does not require user-generated content, as it does not serve user-generated content, and, by extension is not a social media site. Beyond the teleological aspects of social media sites, the user-generated focus also highlights the importance of individual differences in the user-service relationship, as users invariably have personalities that affect how they consume and generate content. One popular method for assessing personality in terms of social media use has been the Big Five [@John1999].

The Big Five is an overarching personality construct that distinguishes between five generally positive personality subconstructs: openness to experience, conscientiousness, extroversion, agreeableness, and emotional stability. Extroversion is typified by sociability and gregariousness; characteristics that seem intuitively linked with the performative and social aspects of social media. Perhaps unsurprisingly, extroversion has been the focus of the majority of research on whether an individual will use social media and how an individual will use social media. 

With respect to whether an individual will use social media, extroversion has been found to be positively correlated with both general social media use [@Correa2010] and Facebook use in particular [@Harbaugh2010; @Jenkins-Guarnieri2012]. Regarding how individuals use social media, individuals high in extroversion are more likely to use Facebook and the internet to communicate with others than those low in extroversion [@Seidman2013; @Wolfradt2001]. Moreover, [@Moore2012] found that extroversion is positively correlated with the number of friends a person has on Facebook. Those with the lowest levels of extroversion in their sample had, on average, 484 fewer friends than those scoring in the top 10%. Similar to extroversion, those high in emotional stability tend to use more social media [@Correa2010]. Even prior to the introduction of most, if not all, social media sites, emotional stability was found to be positively correlated with using the internet for communication and entertainment [@Wolfradt2001]. Despite the apparent value in studying these personality traits, they ignore the distinctly darker aspects of personality. 

The Dark Triad, a construct comprising the intercorrelated, yet distinct, Machiavellianism, subclinical narcissism, and subclinical psychopathy, has garnered substantial interest since its introduction by @Paulhus2002. Machiavellianism originated with Niccolò Machiavelli’s essay, Il Principe [@NiccoloMachiavelli2006], which provided advice on how to properly rule one’s subjects. The advice is most succinctly summarized within the subscales of its most popular measure (i.e., the MACH-IV) [@Christie1970]: be tactical, distrust others, and use pragmatic morality.  

Narcissism originated with the Greek myth of Narcissus, who died after becoming fixated on his own reflection in a pool of water. Its present subclinical incarnation emerged with the creation of the 80-item Narcissistic Personality Inventory (NPI) [@Raskin1979] and has been further adapted into the widely-used NPI-40 [@Raskin1988] and the brief NPI-16 [@Ames2006]. A distillation of these inventories suggests that the current conceptualization of narcissism includes a combination of grandiosity, arrogance, entitlement, and vanity. 

The etymologically ambiguous psychopathy (i.e., “mind” + “illness”) was historically used to refer to a constellation of deficiencies including emotional instability, criminal tendencies, inadequate personality, and pathological lying (United States, 1921, in Huddleson, 1926). Despite nearly 100 years of refinement, psychopathy includes many of the same elements as its original conceptualization. As captured within the fourth edition of the self-report psychopathy scale (SRP-IV) [@Paulhusa], psychopathy is currently operationalized as a combination of four separate facets: (1) interpersonal (e.g., use of manipulation in one’s relationships), (2) affective (e.g., little remorse or guilt), (3) lifestyle (e.g., impulsivity), and (4) antisocial (e.g., breaking laws).

Previous research on the relationship between negative personality traits and social media has primarily focused on narcissism. Part of this may be due to the fact that, as with extroversion, narcissism seems to be intuitively linked to performative behaviours. In fact, it is likely that narcissistic individuals actually exhibit a fair amount of extraversion, as evidenced by the consistent positive correlations found between the two traits [@Muris2017]. Narcissism has been found to be related to posting selfies on social networking sites [@Fox2015; @McCain2016; @Moon2016; @Sorokowski2015; @Weiser2015], with a feedback loop appearing to exist between narcissism and the posting of selfies. A narcissistic disposition seems to cause an individual to post more selfies and posting selfies seems to cause a more narcissistic disposition [@Halpern2016]. Narcissism has also been found to be positively correlated with viewing and commenting on photos on Facebook [@Alloway2014], as well as posting on both Facebook and Twitter [@Panek2013].

The other two Dark Triad traits (i.e., Machiavellianism and psychopathy) have been largely ignored when it comes to investigating their potential influence on social media. Presumably this is due to the absence of a strong theoretical link between the traits and social media use. Nevertheless, Machiavellianism has been found to be negatively correlated with the amount of time spent on Facebook [@Garcia2014] and is positively correlated with trolling on the internet [@Buckels2014]. Psychopathy, on the other hand, has been found to be associated with using Instagram to post selfies [@McCain2016], but the potential, and likely, interrelation between psychopathy and narcissism was not controlled for. It is plausible that the more impulsive aspects of the psychopathic character may cause an individual to be less restrained when posting to social media, but it is equally plausible that psychopathic individuals tend to be higher in narcissism and, consequently, post more selfies. 

This study aims to further explore the relationship between a person’s levels of the Dark Triad traits and their use of social media. Instead of focusing on specific aspects of posting and commenting, we hope to address how the overall use of social media sites is related to personality. Additionally, we wish to explore whether certain sites are frequented by those high on the Dark Triad more than others. The sites investigated are the eight most popular social media sites in the United States as of 2018: Facebook, Pinterest, Instagram, LinkedIn, Twitter, Snapchat, YouTube, and WhatsApp [@Smith2018a], as well as Reddit, 4chan, and Tumblr.

With respect to concrete hypotheses, we expect that (1) narcissism will be positively correlated with both the frequency of using social media and the amount of time spent on social media, independent of the other Dark Triad traits and irrespective of the exact social media site in question. We also expect that (2) psychopathy will be positively correlated with the frequency of general social media use and time spent on social media sites, even when controlling for the effect of narcissism and Machiavellianism and irrespective of the exact social media site in question. Finally, we expect that (3) Machiavellianism will be—independent of the other Dark Triad traits—negatively correlated with both frequency of social media use and time spent on social media sites, once again irrespective of the exact social media site in question. Differences in whether dark personalities use certain sites more than other sites and interactions with gender will be investigated in a purely exploratory fashion. 

# Method

## Participants

```{r data1_participants, include = FALSE}
# calculate sample size at the start
sample_start <- lenique(data1$id)

# remove participants with low response durations
data1 %<>%
  filter(duration_in_seconds > 90)

# calculate number of participants dropped for low response durations
exclusions_duration <- sample_start - lenique(data1$id)

# calculate the standard deviations of responses for every participant
data1_sd <- data1 %>%
  # select only the item columns
  select(id, matches("\\d")) %>%
  # retain only rows that have a distinct id row
  distinct(id, .keep_all = TRUE) %>%
  # create groups by id
  nest(-id)

  # calculate a separate sd for each group (subject)
data1_sd$resp_sd <- map_dbl(data1_sd$data, ~sd(unlist(.x), na.rm = TRUE))

  # add the sds back to data1
data1 <- data1_sd %>%
  # drop the data column
  select(-data) %>%
  # join the two data frames by id
  right_join(data1, by = "id") %>%
  # filter out response sds that are equal to 0
  filter(resp_sd != 0)

  # drop unneeded dataframe 
rm(data1_sd)

# calculate number of participants dropped for low standard deviations
exclusions_sd <- sample_start - exclusions_duration - lenique(data1$id)

# since we are interested in gender as a predictor, drop non-conventional genders
data1 %<>%
  filter(gender == "Female" | gender == "Male")

# calculate number of participants dropped for not being female/male
exclusions_gender <- sample_start - exclusions_duration - exclusions_sd - lenique(data1$id)

# get a dataframe of only unique ids for calculating demographic information
data1_distinct <- data1 %>%
  distinct(id, .keep_all = TRUE)

# calculate demographic information for gender
demo_gender <- data1_distinct %>%
  select(gender) %>%
  perble()

# calculate demographic information for culture
demo_culture <- data1_distinct %>%
  select(race) %>%
  perble()

# calculate descriptives for age
demo_age <- data1_distinct$age %>%
  as.numeric() %>%
  describe() %>%
  unlist()
```

A total of `r sample_start` participants were recruited from the human subject pool at the University of Oregon as part of a general survey. Data was collected over one academic quarter, and all participants were compensated with course credit necessary for meeting a course research requirement. The length of the survey was 10 minutes.  Participants completing the survey in under 90 seconds would have been excluded, but no participants failed to meet this treshold. We did, however, exclude a single participant for having a response standard deviation of zero, an indicator of straightlining. Since we were interested in the effects of gender on social media use and considering that the subsamples for the non-conventional genders were too small to be properly analyzed, we also excluded participants who reported being neither female nor male (*n* = `r exclusions_gender`). Our resulting sample comprised `r lenique(data1$id)` participants (`r spround(demo_gender["Percent", "Female"], 2)`% female; age range: `r demo_age["min"]` to `r demo_age["max"]` years; *M* age = `r demo_age["mean"]`, *SD* age = `r demo_age["sd"]`). With respect to cultural identity, `r spround(demo_culture["Percent", "Caucasian"], 2)`% reported being Caucasian, `r spround(demo_culture["Percent", "Asian"], 2)`% reported being Asian, `r spround(demo_culture["Percent", "Hispanic, Latinx, or Spanish Origin"], 2)`% reported being Hispanic, Latinx, or Spanish, `r spround(demo_culture["Percent", "Black or African American"], 2)`% reported being black or African American, and `r spround(100 - sum(sort(demo_culture["Percent", ], TRUE)[1:4]), 2)`% identified as being from some other culture or prefered not to answer. 

## Procedures and Materials
```{r data1_measures_comps}
# drop unneeded variables from previous section
rm(list = setdiff(ls(), c("data1", "alphas", "data1_distinct", "custom_functions", custom_functions)))

# drop individual item columns
data1 %<>%
  select(-matches("\\d"))

# calculate descriptives for composite columns
descript_comps <- data1_distinct %>%
  select(ends_with("_comp")) %>%
  describe() %>%
  select(vars, n, mean, sd)

descript_comps <- data1_distinct %>%
  filter(gender == "Female") %>%
  select(ends_with("_comp")) %>%
  describe() %>%
  select(vars, n_fem = n, mean_fem = mean, sd_fem = sd) %>%
  right_join(descript_comps, by = "vars")

descript_comps <- data1_distinct %>%
  filter(gender == "Male") %>%
  select(ends_with("_comp")) %>%
  describe() %>%
  select(vars, n_mal = n, mean_mal = mean, sd_mal = sd) %>%
  right_join(descript_comps, by = "vars")

descript_comps$vars <- str_cols_find("_comp", data1, return = "names")

# calculate t, p, and d for the gender comparisons
descript_comps <- cbind(descript_comps,
                        pmap_df(list(m1  = descript_comps$mean_fem,
                                     m2  = descript_comps$mean_mal,
                                     sd1 = descript_comps$sd_fem,
                                     sd2 = descript_comps$sd_mal,
                                     n1  = descript_comps$n_fem,
                                     n2  = descript_comps$n_mal),
                                tdp_from_pars))

# round valuess and include asterisks
descript_comps %<>%
  mutate(d   = spround(d),
         ast = p_to_ast(p),
         t   = spround(t))
  
# format composite descriptives for output
descript_comps %<>%
  mutate(Overall = paste_msd(spround(mean), spround(sd)),
         Female  = paste_msd(spround(mean_fem), spround(sd_fem)),
         Male    = paste_msd(spround(mean_mal), spround(sd_mal))) %>%
  select(Trait = vars, 
         Overall, 
         Female, 
         Male,
         `$t$` = t, 
         ` `   = ast,
         `$d$` = d)

# create meaningful trait names
descript_comps$Trait <- c("Machiavellianism",
                          "Narcissism",
                          "Psychopathy",
                          "Information",
                          "Interpersonal",
                          "Entertaining",
                          "Salience",
                          "Tolerance",
                          "Mood",
                          "Relapse",
                          "Withdrawal",
                          "Conflict")

# insert stub headers
descript_comps <- rbind(c("\\textit{Dark Triad}", rep("", ncol(descript_comps) - 1)),
                        descript_comps[1:3, ],
                        c("\\textit{Motivation}", rep("", ncol(descript_comps) - 1)),
                        descript_comps[4:6, ],
                        c("\\textit{Addiction}", rep("", ncol(descript_comps) - 1)),
                        descript_comps[7:12, ])
```

```{r data1_measures_comps_tab, echo = FALSE, results = 'asis'}
# output gender comparison scale table
descript_comps %>%
  apa_table(caption      = "Descriptive statistics and sex differences for scales",
            col_spanners = list("Mean (SD)" = c(str_cols_find("l", descript_comps, return = "numbers"))),
            stub_indents = list(which(descript_comps$Overall != "")),
            note         = "* \\textit{p} < .05, ** \\textit{p} < .01, *** \\textit{p} < .001.", 
            align        = c("l", "r", "r", "r", "r", "l", "r"),
            escape       = FALSE)
```

```{r data1_measures_sns}
# calculate the number of users by gender and sns
n_gen_sns <- data1 %>%
  mutate(great_0 = if_else(freq > 1, 1, 0)) %>%
  group_by(gender, sns) %>%
  summarise(great_0_sum = sum(great_0, na.rm = TRUE))

# drop sites with users < 20
low_use_sites <- n_gen_sns %>%
  ungroup() %>%
  filter(great_0_sum < 20) %>%
  select(sns) %>%
  mutate(sns = as.character(sns)) %>%
  flatten_chr() %>%
  unique()

data1 %<>%
  filter(!(sns %in% low_use_sites))

# calculate descriptives for a table
descript_sns <- data1 %>%
  group_by(sns) %>%
  summarise(freq_mean = mean(freq, na.rm = TRUE),
            freq_sd   =   sd(freq, na.rm = TRUE),
            len_mean  = mean( len, na.rm = TRUE),
            len_sd    =   sd( len, na.rm = TRUE))

descript_sns <- data1 %>%
  filter(gender == "Female") %>%
  group_by(sns) %>%
  summarise(freq_mean_fem = mean(freq, na.rm = TRUE),
            freq_sd_fem   =   sd(freq, na.rm = TRUE),
            len_mean_fem  = mean( len, na.rm = TRUE),
            len_sd_fem    =   sd( len, na.rm = TRUE),
            n_fem         =    n()) %>%
  right_join(descript_sns, by = "sns")

descript_sns <- data1 %>%
  filter(gender == "Male") %>%
  group_by(sns) %>%
  summarise(freq_mean_mal = mean(freq, na.rm = TRUE),
            freq_sd_mal   =   sd(freq, na.rm = TRUE),
            len_mean_mal  = mean( len, na.rm = TRUE),
            len_sd_mal    =   sd( len, na.rm = TRUE),
            n_mal         =    n()) %>%
  right_join(descript_sns, by = "sns")

# calculate t, p, and d for frequency and length
sns_freq_tdp <- pmap_df(list(m1  = descript_sns$freq_mean_fem,
                             m2  = descript_sns$freq_mean_mal,
                             sd1 = descript_sns$freq_sd_fem,
                             sd2 = descript_sns$freq_sd_mal,
                             n1  = descript_sns$n_fem,
                             n2  = descript_sns$n_mal),
                        tdp_from_pars)

names(sns_freq_tdp) <- paste0(names(sns_freq_tdp), "_freq")

sns_len_tdp <- pmap_df(list(m1  = descript_sns$len_mean_fem,
                            m2  = descript_sns$len_mean_mal,
                            sd1 = descript_sns$len_sd_fem,
                            sd2 = descript_sns$len_sd_mal,
                            n1  = descript_sns$n_fem,
                            n2  = descript_sns$n_mal),
                       tdp_from_pars)

names(sns_len_tdp) <- paste0(names(sns_len_tdp), "_len")

descript_sns <- cbind(descript_sns, sns_freq_tdp, sns_len_tdp)

descript_sns %<>%
  mutate(ast_freq = p_to_ast(p_freq),
         ast_len  = p_to_ast(p_len))
  
# format composite descriptives for output
descript_sns %<>%
  mutate(`Overall`    = paste_msd(spround(freq_mean),     spround(freq_sd)),
         `Female`     = paste_msd(spround(freq_mean_fem), spround(freq_sd_fem)),
         `Male`       = paste_msd(spround(freq_mean_mal), spround(freq_sd_mal)),
         `Overall `   = paste_msd(spround(len_mean),      spround(len_sd)),
         `Female `    = paste_msd(spround(len_mean_fem),  spround(len_sd_fem)),
         `Male `      = paste_msd(spround(len_mean_mal),  spround(len_sd_mal))) %>%
  select(Site = sns, 
         Overall,
         Female,
         Male,
         `$t$` = t_freq,
         ` `   = ast_freq,
         `$d$` = d_freq,
         `Overall `,
         `Female `,
         `Male `,
         `$t$ ` = t_len,
         `  `   = ast_len,
         `$d$ ` = d_len) %>%
  mutate(Site = stringi::stri_trans_totitle(Site))

# split data into two
descript_sns_freq <- descript_sns[1:7]

descript_sns_len <- descript_sns[c(1, 8:13)]

```

```{r data1_measure_sns_freq_tab, echo = FALSE, results = 'asis'}
# output frequency table
descript_sns_freq %>%
  apa_table(caption      = "Descriptive statistics and sex differences for frequency of social media use.",
            col_spanners = list("Mean (SD)" = c(str_cols_find("l", descript_sns_freq, return = "numbers"))),
            note         = "* \\textit{p} < .05, ** \\textit{p} < .01, *** \\textit{p} < .001.", 
            align        = c("l", "r", "r", "r", "r", "l", "r"),
            escape       = FALSE)
```

```{r data1_measure_sns_len_tab, echo = FALSE, results = 'asis'}
# output length table
descript_sns_len %>%
  apa_table(caption      = "Descriptive statistics and sex differences for average length of social media use per day in minutes.",
            col_spanners = list("Mean (SD)" = c(str_cols_find("l", descript_sns_len, return = "numbers"))),
            note         = "* \\textit{p} < .05, ** \\textit{p} < .01, *** \\textit{p} < .001.", 
            align        = c("l", "r", "r", "r", "r", "l", "r"),
            escape       = FALSE)

# drop unneeded variables
rm(list = setdiff(ls(), c("data1", "alphas", "data1_distinct", "custom_functions", custom_functions)))
```

Participants completed an online survey that included (1) a measure of the Dark Triad personality traits (i.e., Machiavellianism, narcissism, psychopathy), (2) questions assessing  participants' frequency of visiting eleven social media sites, (3) questions assessing the amount of time participants spend on those eleven social media sites, (4) a scale assessing the participants' addiction to social media, (5) a scale measuring participants' reasons for using the internet, and (6) two questions assessing participants' overall view of social media sites. The following analyses will focus on the measure of the Dark Triad and the questions assessing frequency of use and amount of time spent on social media sites.

The Dark Triad was assessed using the Dirty Dozen [@Jonason2010d], comprising four items each for Machiavellianism ($\alpha$ = `r alphas["dd_mach"]`), narcissism ($\alpha$ = `r alphas["dd_narc"]`), and psychopathy ($\alpha$ = `r alphas["dd_psyc"]`). Participants responded using a 5-pt Likert scale (1 = "Strongly disagree"; 5 = "Strongly agree"). Descriptive statistics and gender comparisons for the Dark Triad traits, as well as the other scale measures, can be seen in Table `r (table_count <- table_count + 1)`.

Participants were also asked how frequently they visited 11 social media sites on a 5-pt scale (1 = "less often than every few weeks"; 5 = "several times a day"). The list of sites included Facebook, Instagram, LinkedIn, Twitter, Snapchat, YouTube, WhatsApp, Reddit, 4chan, and Tumblr. However, certain sites were only used be women (i.e., Pinterest) or men (i.e., 4chan). Additional sites included did include users from both genders, but in an amount that would lead to misinterpretatiosn. We dropped sites with fewer than 20 participants reporting visiting the site at least every few weeks from the analysis from either gender. In the end, we retained frequency of use ratings for Facebook, Instagram, Reddit, Snapchat, Twitter, and YouTube. The descriptive statistics and gender comparisons for those sites can be seen in Table `r (table_count <- table_count + 1)`.

We also asked participants the average number of minutes they spend on each site on an average day. Again, we only retained those sites that had more than 20 at-least-rare users of both genders. For the descriptive statistics and gender comparisons for the average length of time in minutes spent on those sites per day, see Table `r (table_count <- table_count + 1)`. 

# Results
```{r data1_zeroorder, include = FALSE}
# set the data up for the correlation matrix
data1_corr <- data1 %>%
  spread(sns_perc_context, sns_perc_rating) %>%
  select(id, freq, len, sns) %>%
  gather(unit, value, c(freq, len)) %>%
  unite(temp, unit, sns) %>%
  spread(temp, value)

# calculate average frequency and total minutes spent on sns accross all sites
data1_corr$sns_freq_avg <- str_composite("freq_", data1_corr)
data1_corr$sns_len_sum  <- str_composite("len_", data1_corr, sum = TRUE)

# tidy data for zero order analsis
data1_corr %<>%
  select(id, sns_freq_avg, sns_len_sum) %>%
  left_join(data1, by = "id") %>%
  distinct(id, .keep_all = TRUE) %>%
  select(sns_freq_avg,
         sns_len_sum,
         gender,
         starts_with("dd")) 

# corr. test
zo_fem <- data1_corr %>%
  filter(gender == "Female") %>%
  select(-gender) %>%
  corr.test()

zo_mal <- data1_corr %>%
  filter(gender == "Male") %>%
  select(-gender) %>%
  corr.test()
  
zo <- zo_fem$r

for (i in 1:nrow(zo)) {
  for (j in 1:ncol(zo)) {
    if (i / j > 1) {
      r <- spround(zo_mal$r[i, j])
      p <- zo_mal$p[j, i] # switched in order to get the "holm"-adjusted values
      if (p < .01) {
        p <- "**"
      } else if (p < .05) {
        p <- "*"
      } else {
        p <- ""
      }
      zo[i, j] <- paste(r, p, sep = "")
    } else {
      r <- spround(zo_fem$r[i, j])
      p <- zo_fem$p[i, j]
      if (p < .01) {
        p <- "**"
      } else if (p < .05) {
        p <- "*"
      } else {
        p <- ""
      }
      zo[i, j] <- paste(r, p, sep = "")
    }
  }
}

# rename columns and headers
colnames(zo) <- 1:ncol(zo)
rownames(zo) <- c("1. SNS Frequency",
                  "2. SNS Length",
                  "3. Machiavellianism",
                  "4. Narcissism",
                  "5. Psychopathy")

zo[zo == "1.00**"] <- "-"
```

```{r data1_zeroorder_tab, echo = FALSE, results = 'asis'}
# print table
zo %>%
  apa_table(caption = "Zero-order correlations for frequency and length of social media use and the Dark Triad traits.",
            note = paste0("* \\textit{p} < .05, ** \\textit{p} < .01. Values above the diagononal are for women (\\textit{n} = ",
                         median(zo_fem$n),
                         "); values below the diagonal are for men (\\textit{n} = ",
                         median(zo_mal$n),
                         "). P-values were adjusted using the Holm-Bonferonni method and were adjusted seperately for the male and female subsamples."),
            align = "l",
            escape = FALSE)

# drop unneeded variables
rm(list = setdiff(ls(), c("data1", "custom_functions", custom_functions)))
```

Table `r (table_count <- table_count + 1)` for zero-order correlations, which seems to suggest that at conventional significant levels there is no relationship between the Dark Triad and either the freuqency of social media use or the average length of social media use per day. However, the frequency and length measures inclduded in the matrix are collapsing accross social media sites. 

In order to leverage the multiple observations gathered for every participant, we opted to run two series of linear mixed-effects model. In terms of predictors, both models were identical. They differed by outcome variable:  The first model had frequency of social media use as an outcome variable. The second model had length of social media use per day as the outcome variable.

```{r data1_lmer_freq, include = FALSE}
# filter data1 for nas
data1 %<>%
  filter(!is.na(dd_mach_comp),
         !is.na(dd_narc_comp),
         !is.na(dd_psyc_comp),
         !is.na(freq))

# grand-mean center dark triad traits
data1 %<>%
  mutate_at(vars(starts_with("dd")), scale, scale = FALSE)

# fit unconditional model
model_freq_0 <- lmer(freq ~ (1 | id), data = data1, REML = FALSE)

# calculate ICCs
freq_icc <- icc(model_freq_0)

# fit gender model
model_freq_1 <- lmer(freq ~ gender + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with the dark triad traits
model_freq_2 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with sns
model_freq_3 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender X d3 interaciton
model_freq_4 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender x sns interaction
model_freq_5 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with d3 x sns interaction
model_freq_6 <- lmer(freq ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            dd_mach_comp * sns + 
                            dd_narc_comp * sns +
                            dd_psyc_comp * sns + 
                            (1 | id), data = data1, REML = FALSE)

# compare models
freq_model_comp <- anova(model_freq_0,
                         model_freq_1,
                         model_freq_3,
                         model_freq_4,
                         model_freq_5,
                         model_freq_6)

# respecify model (drop gender x d3 interactions)
model_freq_final <- lmer(freq ~ gender + 
                                dd_mach_comp + 
                                dd_narc_comp +
                                dd_psyc_comp + 
                                sns +
                                gender * sns +
                                (1 | id), data = data1, REML = FALSE)

# summarize final model
model_freq_final_sum <- summary(model_freq_final)

```

```{r data1_lmer_len, include = FALSE}
# fit unconditional model
model_len_0 <- lmer(len ~ (1 | id), data = data1, REML = FALSE)

# calculate ICCs
len_icc <- icc(model_len_0)

# fit gender model
model_len_1 <- lmer(len ~ gender + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with the dark triad traits
model_len_2 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with sns
model_len_3 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender X d3 interaciton
model_len_4 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            (1 | id), data = data1, REML = FALSE)

# fit model with gender x sns interaction
model_len_5 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            (1 | id), data = data1, REML = FALSE)

# fit model with d3 x sns interaction
model_len_6 <- lmer(len ~ gender + 
                            dd_mach_comp + 
                            dd_narc_comp +
                            dd_psyc_comp + 
                            sns +
                            gender * dd_mach_comp + 
                            gender * dd_narc_comp + 
                            gender * dd_psyc_comp + 
                            gender * sns +
                            dd_mach_comp * sns + 
                            dd_narc_comp * sns +
                            dd_psyc_comp * sns + 
                            (1 | id), data = data1, REML = FALSE)

# compare models
len_model_comp <- anova(model_len_0,
                        model_len_1,
                        model_len_3,
                        model_len_4,
                        model_len_5,
                        model_len_6)

# respecify model (drop gender x d3 interactions)
model_len_final <- lmer(len ~ gender + 
                              dd_mach_comp + 
                              dd_narc_comp +
                              dd_psyc_comp + 
                              sns +
                              gender * sns +
                              (1 | id), data = data1, REML = FALSE)

# summarize final model
model_len_final_sum <- summary(model_len_final)

```

In terms of random effects, we allowed random intercepts accross subjects. It would have been defensible to run the model as a two-level cross-classified, nesting observations within both subjects and social media sites. However, we were interested in the effects of social media site and thus included them as fixed effects in our model. In the present case, grouping by subject explaiend `r spround(freq_icc * 100)`% of the variation in frequency of social media use an `r spround(len_icc * 100)`% of the variation in the length of social media use.

We added fixed effects to our model in the following order: (1) gender, (2) the Dark Triad traits, (3) the specific social media site, (4) the interaction between gender and the Dark Triad traits, (5) the interaction between gender and the social media sites, and (6) the interaction between the Dark Triad traits and the  social media sites. The full model for the two models were:


$L1: Y_{ij} = \beta_{0j} + \beta_{1j}SMS_{ij} + r_{ij}$

$L2: \beta_{0j} = \gamma_{00} + \gamma_{01}G{j} + \gamma_{02}M{j} + \gamma_{03}N_{j} + \gamma_{04}P_{j} + \gamma_{05}G_{j}*M_{j} + \gamma_{06}G_{j}*N_{j} + \gamma_{07}G_{j}*P_{j}  + u_{0j}$

$\;\;\;\;\;\;\; \beta_{1j} = \gamma_{10} + \gamma_{11}G{j} + \gamma_{12}M_{j} + \gamma_{13}N_{j} + \gamma_{14}P_{j}  + u_{1j}$


Results of the model comparisons can be see in Table `r (table_count <- table_count + 1)`.

Interpretation of the results goes here. 

```{r data1_model_comps_tab, echo = FALSE, results = 'asis'}
# format for outputting
freq_model_comp %<>%
  select(df = Df,
         `$\\chi^2$ df` = `Chi Df`,
         AIC:logLik,
         `$\\chi^2$` = Chisq,
         `$p$` = `Pr(>Chisq)`)

len_model_comp %<>%
  select(`AIC ` = AIC,
         `BIC ` = BIC,
         `logLik ` = logLik,
         `$\\chi^2$ ` = Chisq,
         `$p$ ` = `Pr(>Chisq)`)

# combine tables
model_comps_comb <- cbind(freq_model_comp, len_model_comp)

# round tables to appropriat enumber of digits
model_comps_comb <- pmap_df(list(model_comps_comb, 
                                 c(0, 0, 2, 2, 2, 2, 3, 2, 2, 2, 2, 3), 
                                 c(rep(TRUE, 2), rep(c(rep(TRUE, 4), FALSE), 2))),
                            ~spround(x = ..1, digits = ..2, leading0 = ..3))

model_comps_comb$Model <- c("Null",
                            "Gender (G)",
                            "Dark Triad (D3)",
                            "Social Media (SNS)",
                            "G X SNS",
                            "D3 X SNS")

model_comps_comb %<>%
  select(Model,
         everything())

model_comps_comb <- apply(model_comps_comb, MARGIN = c(1, 2), function(string) gsub(".000", "<.000", string))

model_comps_comb <- apply(model_comps_comb, MARGIN = c(1, 2), function(string) gsub("NA", "", string))

# output table
model_comps_comb %>%
 apa_table(caption = "Log likelihood comparison of linear mixed-effects models predicting frequency of visiting social media sites and length of time spent on social media sites.",
           escape = FALSE,
           align = "lrrrrrrrrrrrr",
           landscape = TRUE,
           col_spanners = list("Frequency" = c(4, 8),
                               "Length" = c(9, 13)),
           note = "something something")



```

```{r data1_machxgender_plot}
# convert dark triad traits to categorical using con_to_cat
data1$mach_group <- con_to_cat(data1$dd_mach_comp)
data1$narc_group <- con_to_cat(data1$dd_narc_comp)
data1$psyc_group <- con_to_cat(data1$dd_psyc_comp)

#Examining whether social media use differ as a function of Machiavellianism
data1 %>%
  filter(mach_group != "Mid") %>% 
  group_by(sns, mach_group) %>%
  summarize(len_m  = mean(len, na.rm = TRUE),
            len_se = sundry::se(len)) %>%
  ggplot(aes(x = mach_group, y = len_m, fill = mach_group)) +
    geom_col(position = "dodge", alpha = 0.8) +
    geom_errorbar(aes(ymin = len_m - len_se, 
                      ymax = len_m + len_se),
                  position = "dodge",
                  colour = "grey30") +
    scale_fill_manual(values = c("#4A235A", "#D2B4DE")) +
    facet_wrap(~sns) +
    theme_bw(base_size = 14) +
    guides(fill=FALSE) +
    theme(axis.title = element_text(face = "bold"),
          strip.text = element_text(face = "bold", size = 14),
          legend.title = element_text(face = "bold")) +
    labs(y = "Average length spent on Social \nMedia Sites per Day (minutes)",
         x = "Machiavellianism")
```

```{r data1_narcxgender_plot}
#Examining whether social media use differ as a funciton of Narcissism (no gender)
data1 %>%
  filter(narc_group != "Mid") %>%
  group_by(sns, narc_group) %>% 
  summarize(len_m  = mean(len, na.rm = TRUE),
            len_se = sundry::se(len)) %>%
    ggplot(aes(x = narc_group, y = len_m, fill = narc_group)) +
    geom_col(position = "dodge", alpha = 0.8) +
    geom_errorbar(aes(ymin = len_m - len_se, 
                      ymax = len_m + len_se),
                  position = "dodge",
                  colour = "grey30") +
    scale_fill_manual(values = c("#17737B", "#5FCDD6")) +
    facet_wrap(~sns) +
    guides(fill=FALSE) +
    theme_bw(base_size = 14) +
    theme(axis.title = element_text(face = "bold"),
             strip.text = element_text(face = "bold", size = 14),
             legend.title = element_text(face = "bold")) +
    labs(y = "Average length spent on Social \nMedia Sites per Day (minutes)",
         x = "Narcissism")
```

```{r data1_psycxgender_plot}
#Examining whether social media use differ as a funciton of Psychopathy (no gender)
data1 %>%
  filter(psyc_group != "Mid") %>%
  group_by(sns, psyc_group) %>% 
  summarize(len_m  = mean(len, na.rm = TRUE),
            len_se = sundry::se(len)) %>%
  ggplot(aes(x = psyc_group, y = len_m, fill = psyc_group)) +
    geom_col(position = "dodge", alpha = 0.8) +
    geom_errorbar(aes(ymin = len_m - len_se, 
                      ymax = len_m + len_se),
                  position = "dodge",
                  colour = "grey30") +
    scale_fill_manual(values = c("#7B1740", "#D1769B")) +
    facet_wrap(~sns) +
    guides(fill=FALSE) +
    theme_bw(base_size = 14) +
    theme(axis.title = element_text(face = "bold"),
             strip.text = element_text(face = "bold", size = 14),
             legend.title = element_text(face = "bold")) +
    labs(y = "Average length spent on Social \nMedia Sites per Day (minutes)",
         x = "Psychopathy") 


```

```{r gender_parallel_iteration, warning = FALSE}

# examining gender differences in minutes spent on social media each day
# by social media site
data1 %>%
  group_by(gender, sns) %>%
  summarise(len_m = mean(len, na.rm = TRUE),
            len_se = se(len, na.rm = TRUE)) %>%
  ggplot(aes(x = sns, y = len_m, fill = gender)) + 
    geom_col(position = "dodge", alpha = 0.9) +
    scale_fill_manual(values = c("#633974", "#2A99A2"),
                      name = "Gender") +
    theme_bw(base_size = 14) +
    theme(axis.title = element_text(face = "bold"),
          strip.text = element_text(face = "bold", size = 14),
          legend.title = element_text(face = "bold")) +
    coord_flip() +
    labs(y = "Average Length Spent on Social Media Sites per Day (minutes)",
         x = "Social Media Site")

########################################################
### instance of parallel iteration # 1 (1 required) ####
## instance of purr::nest%>%mutate() # 1 (1 required) ##
########################################################

# lets examine potential gender effects on social media use..
# ...as a function of the dark triad traits

plot_data <- data1 %>%
  gather(key = dd_trait, value = standing, mach_group:psyc_group) %>%
  mutate(dd_trait = recode(dd_trait,
                        "mach_group" = "Machiavellianism",
                        "narc_group" = "Narcissism",
                        "psyc_group" = "Psychopathy"))
  
plot_data$standing <- factor(plot_data$standing, levels = c("Low", "Mid", "High"))

plot_data %<>%
  #filter(standing != "Mid") %>%
  spread(sns_perc_context, sns_perc_rating) %>%
  group_by(dd_trait, standing) %>%
  nest()

plot_data <- plot_data %>%
  mutate(plots = pmap(
    # create list of plot resources
    list(data_for_plot = plot_data$data,
         dd_trait = plot_data$dd_trait, 
         standing = plot_data$standing),
    # create plots
    function(data_for_plot, dd_trait, standing) {
      ggplot(data_for_plot, aes(x = gender, y = len, fill = gender)) +
        geom_col(position = "dodge") +
        scale_fill_manual(values = c("#633974", "#2A99A2")) +
        # apply theme minimal
        theme_bw(base_size = 12) +
        guides(fill=FALSE) +
        facet_wrap(~sns) +
        #scale_color_manual(values = c("#17737B", "#5FCDD6")) +
        theme(axis.title = element_text(face = "bold"),
              legend.title = element_text(face = "bold"),
              title = element_text(face = "bold"),
              strip.text = element_text(face = "bold"),
              legend.position = "bottom") +
        # set labels
        labs(title    = glue("Relation Between Time on Social Media and Gender for those {standing} in {dd_trait}"),
             y        = "Total Time Spent on Social Media \nSites per Day (Minutes)",
             x        = "Gender")
}))

plot_data$plots[[1]]
plot_data$plots[[2]]
plot_data$plots[[3]]
plot_data$plots[[4]]
plot_data$plots[[5]]
plot_data$plots[[6]]
plot_data$plots[[7]]
plot_data$plots[[8]]
plot_data$plots[[9]]
```

# Discussion

Something something something

\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
